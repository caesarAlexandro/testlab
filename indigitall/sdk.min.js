!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s=t();for(var i in s)("object"==typeof exports?exports:e)[i]=s[i]}}(this,(()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.1.0","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>B});var e={};s.r(e),s.d(e,{BaseClient:()=>T,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>S,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>R,EventType:()=>f});var n={};s.r(n),s.d(n,{CommonUtils:()=>y,CorePermissions:()=>w,CryptoUtils:()=>b,ErrorUtils:()=>_,JsonUtils:()=>U,Log:()=>m,LogLevel:()=>I,Validations:()=>L});var o={platform:"webpush",version:"0.0.1"};const r=s(147);o.version=r.version;const a=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},c=l,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),n=s.objectStore("indigitallStore"),o=n.index("storeIndex");e({db:t,tx:s,store:n,index:o})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,n)=>{e||n(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=h,u=class{constructor(){this.storage=c,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){c.setItem(e,t)}getStorage(e){return c.getItem(e)}clearStorage(){c.clear()}setBrowserPublicKey(e){c.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return c.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){c.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return c.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){c.setItem(this.APP_KEY,e)}getAppKey(){return c.getItem(this.APP_KEY)}setVAPID(e){c.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return c.getItem(this.VAPID_PUBLIC)}setEnabled(e){c.setItem(this.ENABLED,e)}getEnabled(){return c.getItem(this.ENABLED)}setServiceSyncTime(e){c.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return c.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){c.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return c.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){c.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return c.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){c.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!c&&c.getItem(this.REQUEST_LOCATION)}async setPlatform(e){c.setItem(this.PLATFORM,e)}getPlatform(){return c&&c.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){c.setItem(this.BROWSER_NAME,e)}getBrowserName(){return c.getItem(this.BROWSER_NAME)}setBrowserVersion(e){c.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return c.getItem(this.BROWSER_VERSION)}async setOsName(e){c.setItem(this.OS_NAME,e)}getOsName(){return c.getItem(this.OS_NAME)}setOsVersion(e){c.setItem(this.OS_VERSION,e)}getOsVersion(){return c.getItem(this.OS_VERSION)}setDeviceType(e){c.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return c.getItem(this.DEVICE_TYPE)}setSupported(e){c.setItem(this.SUPPORTED,e)}getSupported(){return c.getItem(this.SUPPORTED)}setServiceTimestamp(e){c.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return c.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){c.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return c.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){c.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return c.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){c.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==c.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){c.setItem(this.LOG_LEVEL,e)}getLogLevel(){return c.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){c.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return c.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){c&&c.isLocalStorageAvailable()&&c.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{c&&c.isLocalStorageAvailable()?e=c.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){c.setItem(this.EXTERNAL_ID,e)}getExternalId(){return c.getItem(this.EXTERNAL_ID)}async getDeviceJson(){return c.getItem(this.DEVICE_JSON)}async setDeviceJson(e){c.setItem(this.DEVICE_JSON,e)}async getRegisteredByCookie(){return c.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){c.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){c.setItem(this.LATITUDE,e)}getLatitude(){return c.getItem(this.LATITUDE)}setLongitude(e){c.setItem(this.LONGITUDE,e)}getLongitude(){return c.getItem(this.LONGITUDE)}},I=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),p=I;class g{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=p.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=p.DEBUG&&e<=p.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=p.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}i(){if(this.level<=p.INFO)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}w(){if(this.level<=p.WARNING)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}e(){if(this.level<=p.ERROR)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}e(e){return this.level<=p.ERROR&&(this.log+=`${e.errorCode}: ${e.errorMessage}`),this}writeLog(){this.log.length>0&&console.log(this.tag,this.log),this.log=[]}}const m=g,R=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},_=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new R(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new R(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},T=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const n=new m("[IND]BaseClient: ");let o=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(o=o.replace("v1","v2"));const r={method:e,headers:s.addHeaders()};e!==this.GET&&(r.body=JSON.stringify(s.getBody())),i&&(r.credentials=i);try{const t=await fetch(o,r),i=await t.json();return t.ok?(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog(),new R(t.status,t.statusText))}catch(t){return n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),_.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),S=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}static setDeviceJson(e){(new u).setDeviceJson(JSON.stringify(e.toJSON()))}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),f=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),y=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},w=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new m("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},v=new m("[IND]Crypto"),C=new TextEncoder("utf-8"),D="HMAC",b=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",C.encode(e),{name:D,hash:{name:"SHA-256"}},!1,["sign","verify"]),n=await s.sign(D,i,C.encode(t)),o=new Uint8Array(n),r=Array.prototype.map.call(o,(e=>("00"+e.toString(16)).slice(-2))).join("");return v.d("hmac: ",r).writeLog(),r}catch(e){return void v.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},L=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},B={Repository:u,Config:a,Api:e,Models:t,Utils:n}})(),i})(),e.exports=t()},828:(e,t,s)=>{"use strict";s.d(t,{Core:()=>F});var i={};s.r(i),s.d(i,{BaseClient:()=>P,BaseRequest:()=>S});var n={};s.r(n),s.d(n,{Channel:()=>N,Device:()=>f,DeviceStatus:()=>y,ErrorDictionary:()=>O,ErrorModel:()=>_,EventType:()=>w});var o={};s.r(o),s.d(o,{CommonUtils:()=>v,CorePermissions:()=>C,CryptoUtils:()=>L,ErrorUtils:()=>A,JsonUtils:()=>B,Log:()=>R,LogLevel:()=>p,Validations:()=>M});s(923);var r={platform:"webpush",version:"0.0.1"};const a=s(391);r.version=a.version;const l=r=Object.assign(r,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}});const c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=c;const h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),n=s.objectStore("indigitallStore"),o=n.index("storeIndex");e({db:t,tx:s,store:n,index:o})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,n)=>{e||n(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}};const d=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==d.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},u=d;const I=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE"}setItemSessionStorage(e,t){u.setItem(e,t)}getItemSessionStorage(e){return u.getItem(e)}clearSessionStorage(){u.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){const e=E.getItem(this.SERVICE_SYNC_TIME);return e||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){const e=E.getItem(this.LOCATION_UPDATE_MINUTES);return e||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||l.platform}getVersion(){return l.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getDeviceJson(){return E.getItem(this.DEVICE_JSON)}async setDeviceJson(e){E.setItem(this.DEVICE_JSON,e)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}},p=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=p;class m{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new I).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}e(e){return this.level<=g.ERROR&&(this.log+=`${e.errorCode}: ${e.errorMessage}`),this}writeLog(){this.log.length>0&&console.log(this.tag,this.log),this.log=[]}}const R=m;const _=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}};const A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new _(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new _(GENERAL_ERROR,"general error",s)}}},T={GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410};const O={ErrorCode:T,ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}};const P=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const n=new R("[IND]BaseClient: ");let o=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(o=o.replace("v1","v2"));const r={method:e,headers:s.addHeaders()};e!==this.GET&&(r.body=JSON.stringify(s.getBody())),i&&(r.credentials=i);try{const t=await fetch(o,r),i=await t.json();return t.ok?(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog(),new _(t.status,t.statusText))}catch(t){return n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(O,O.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}};const S=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new I).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},N=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"});const f=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new I).getBrowserPublicKey(),this.browserPrivateKey=(new I).getBrowserPrivateKey(),this.platform=(new I).getPlatform(),this.version=(new I).getVersion(),this.browserName=(new I).getBrowserName(),this.browserVersion=(new I).getBrowserVersion(),this.osName=(new I).getOsName(),this.osVersion=(new I).getOsVersion(),this.deviceType=(new I).getDeviceType(),(new I).getEnabled()&&(this.enabled="true"===(new I).getEnabled()),(new I).getExternalId()&&(this.externalCode=(new I).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new I).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new I).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}static setDeviceJson(e){(new I).setDeviceJson(JSON.stringify(e.toJSON()))}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),w=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"});const v=class{static isServiceTimestampExceed(){return!(new I).getServiceTimestamp()||(new I).getServiceSyncTime()<=(Date.now()-(new I).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}};const C=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new R("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},D=new R("[IND]Crypto"),b=new TextEncoder("utf-8"),U="HMAC";const L=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",b.encode(e),{name:U,hash:{name:"SHA-256"}},!1,["sign","verify"]),n=await s.sign(U,i,b.encode(t)),o=new Uint8Array(n),r=Array.prototype.map.call(o,(e=>("00"+e.toString(16)).slice(-2))).join("");return D.d("hmac: ",r).writeLog(),r}catch(e){return void D.e("error:",e).writeLog()}}};const B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}};const M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},F={Repository:I,Config:l,Api:i,Models:n,Utils:o}},253:function(e){var t;t=()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.1.0","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>B});var e={};s.r(e),s.d(e,{BaseClient:()=>T,BaseRequest:()=>O});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>S,DeviceStatus:()=>N,ErrorDictionary:()=>A,ErrorModel:()=>R,EventType:()=>f});var n={};s.r(n),s.d(n,{CommonUtils:()=>y,CorePermissions:()=>w,CryptoUtils:()=>b,ErrorUtils:()=>_,JsonUtils:()=>U,Log:()=>m,LogLevel:()=>I,Validations:()=>L});var o={platform:"webpush",version:"0.0.1"};const r=s(147);o.version=r.version;const a=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),l=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},c=l,E=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),n=s.objectStore("indigitallStore"),o=n.index("storeIndex");e({db:t,tx:s,store:n,index:o})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,n)=>{e||n(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},h=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=h,u=class{constructor(){this.storage=c,this.db=E,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){c.setItem(e,t)}getStorage(e){return c.getItem(e)}clearStorage(){c.clear()}setBrowserPublicKey(e){c.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return c.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){c.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return c.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){c.setItem(this.APP_KEY,e)}getAppKey(){return c.getItem(this.APP_KEY)}setVAPID(e){c.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return c.getItem(this.VAPID_PUBLIC)}setEnabled(e){c.setItem(this.ENABLED,e)}getEnabled(){return c.getItem(this.ENABLED)}setServiceSyncTime(e){c.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return c.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){c.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return c.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){c.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return c.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){c.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!c&&c.getItem(this.REQUEST_LOCATION)}async setPlatform(e){c.setItem(this.PLATFORM,e)}getPlatform(){return c&&c.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){c.setItem(this.BROWSER_NAME,e)}getBrowserName(){return c.getItem(this.BROWSER_NAME)}setBrowserVersion(e){c.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return c.getItem(this.BROWSER_VERSION)}async setOsName(e){c.setItem(this.OS_NAME,e)}getOsName(){return c.getItem(this.OS_NAME)}setOsVersion(e){c.setItem(this.OS_VERSION,e)}getOsVersion(){return c.getItem(this.OS_VERSION)}setDeviceType(e){c.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return c.getItem(this.DEVICE_TYPE)}setSupported(e){c.setItem(this.SUPPORTED,e)}getSupported(){return c.getItem(this.SUPPORTED)}setServiceTimestamp(e){c.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return c.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){c.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return c.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){c.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return c.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){c.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==c.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){c.setItem(this.LOG_LEVEL,e)}getLogLevel(){return c.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){c.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return c.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){c&&c.isLocalStorageAvailable()&&c.setItem(this.EXTERNAL_ID,e),E&&E.IDB&&await E.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{c&&c.isLocalStorageAvailable()?e=c.getItem(this.EXTERNAL_ID):E&&E.IDB&&(e=await E.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){c.setItem(this.EXTERNAL_ID,e)}getExternalId(){return c.getItem(this.EXTERNAL_ID)}async getDeviceJson(){return c.getItem(this.DEVICE_JSON)}async setDeviceJson(e){c.setItem(this.DEVICE_JSON,e)}async getRegisteredByCookie(){return c.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){c.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){c.setItem(this.LATITUDE,e)}getLatitude(){return c.getItem(this.LATITUDE)}setLongitude(e){c.setItem(this.LONGITUDE,e)}getLongitude(){return c.getItem(this.LONGITUDE)}},I=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),p=I;class g{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=p.INFO,this.setLogLevel((new u).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=p.DEBUG&&e<=p.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=p.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}i(){if(this.level<=p.INFO)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}w(){if(this.level<=p.WARNING)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}e(){if(this.level<=p.ERROR)for(let e=0;e<arguments.length;e++)this.log+=g.addedAsString(arguments[e]);return this}e(e){return this.level<=p.ERROR&&(this.log+=`${e.errorCode}: ${e.errorMessage}`),this}writeLog(){this.log.length>0&&console.log(this.tag,this.log),this.log=[]}}const m=g,R=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},_=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new R(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new R(GENERAL_ERROR,"general error",s)}}},A={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},T=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const n=new m("[IND]BaseClient: ");let o=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(o=o.replace("v1","v2"));const r={method:e,headers:s.addHeaders()};e!==this.GET&&(r.body=JSON.stringify(s.getBody())),i&&(r.credentials=i);try{const t=await fetch(o,r),i=await t.json();return t.ok?(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog(),new R(t.status,t.statusText))}catch(t){return n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),_.showError(A,A.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},O=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new u).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),S=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new u).getBrowserPublicKey(),this.browserPrivateKey=(new u).getBrowserPrivateKey(),this.platform=(new u).getPlatform(),this.version=(new u).getVersion(),this.browserName=(new u).getBrowserName(),this.browserVersion=(new u).getBrowserVersion(),this.osName=(new u).getOsName(),this.osVersion=(new u).getOsVersion(),this.deviceType=(new u).getDeviceType(),(new u).getEnabled()&&(this.enabled="true"===(new u).getEnabled()),(new u).getExternalId()&&(this.externalCode=(new u).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new u).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new u).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}static setDeviceJson(e){(new u).setDeviceJson(JSON.stringify(e.toJSON()))}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},N=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),f=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),y=class{static isServiceTimestampExceed(){return!(new u).getServiceTimestamp()||(new u).getServiceSyncTime()<=(Date.now()-(new u).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},w=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new m("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},v=new m("[IND]Crypto"),C=new TextEncoder("utf-8"),D="HMAC",b=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",C.encode(e),{name:D,hash:{name:"SHA-256"}},!1,["sign","verify"]),n=await s.sign(D,i,C.encode(t)),o=new Uint8Array(n),r=Array.prototype.map.call(o,(e=>("00"+e.toString(16)).slice(-2))).join("");return v.d("hmac: ",r).writeLog(),r}catch(e){return void v.e("error:",e).writeLog()}}},U=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},L=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},B={Repository:u,Config:a,Api:e,Models:t,Utils:n}})(),i})(),e.exports=t()},635:(e,t,s)=>{"use strict";s.d(t,{Core:()=>M});var i={};s.r(i),s.d(i,{BaseClient:()=>O,BaseRequest:()=>P});var n={};s.r(n),s.d(n,{Channel:()=>S,Device:()=>N,DeviceStatus:()=>f,ErrorDictionary:()=>T,ErrorModel:()=>_,EventType:()=>y});var o={};s.r(o),s.d(o,{CommonUtils:()=>w,CorePermissions:()=>v,CryptoUtils:()=>U,ErrorUtils:()=>A,JsonUtils:()=>L,Log:()=>R,LogLevel:()=>p,Validations:()=>B}),s(923);var r={platform:"webpush",version:"0.0.1"};const a=s(391);r.version=a.version;const l=r=Object.assign(r,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),c=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==c.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},E=c,h=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),n=s.objectStore("indigitallStore"),o=n.index("storeIndex");e({db:t,tx:s,store:n,index:o})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,n)=>{e||n(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},d=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==d.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},u=d,I=class{constructor(){this.storage=E,this.db=h,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE"}setItemSessionStorage(e,t){u.setItem(e,t)}getItemSessionStorage(e){return u.getItem(e)}clearSessionStorage(){u.clearMessages()}setStorage(e,t){E.setItem(e,t)}getStorage(e){return E.getItem(e)}clearStorage(){E.clear()}setBrowserPublicKey(e){E.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return E.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){E.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return E.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){E.setItem(this.APP_KEY,e)}getAppKey(){return E.getItem(this.APP_KEY)}setVAPID(e){E.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return E.getItem(this.VAPID_PUBLIC)}setEnabled(e){E.setItem(this.ENABLED,e)}getEnabled(){return E.getItem(this.ENABLED)}setServiceSyncTime(e){E.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return E.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){E.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return E.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){E.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return E.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){E.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!E&&E.getItem(this.REQUEST_LOCATION)}async setPlatform(e){E.setItem(this.PLATFORM,e)}getPlatform(){return E&&E.getItem(this.PLATFORM)||l.platform}getVersion(){return l.version}async setBrowserName(e){E.setItem(this.BROWSER_NAME,e)}getBrowserName(){return E.getItem(this.BROWSER_NAME)}setBrowserVersion(e){E.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return E.getItem(this.BROWSER_VERSION)}async setOsName(e){E.setItem(this.OS_NAME,e)}getOsName(){return E.getItem(this.OS_NAME)}setOsVersion(e){E.setItem(this.OS_VERSION,e)}getOsVersion(){return E.getItem(this.OS_VERSION)}setDeviceType(e){E.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return E.getItem(this.DEVICE_TYPE)}setSupported(e){E.setItem(this.SUPPORTED,e)}getSupported(){return E.getItem(this.SUPPORTED)}setServiceTimestamp(e){E.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return E.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){E.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return E.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){E.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return E.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){E.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==E.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){E.setItem(this.LOG_LEVEL,e)}getLogLevel(){return E.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){E.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return E.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){E&&E.isLocalStorageAvailable()&&E.setItem(this.EXTERNAL_ID,e),h&&h.IDB&&await h.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{E&&E.isLocalStorageAvailable()?e=E.getItem(this.EXTERNAL_ID):h&&h.IDB&&(e=await h.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){E.setItem(this.EXTERNAL_ID,e)}getExternalId(){return E.getItem(this.EXTERNAL_ID)}async getDeviceJson(){return E.getItem(this.DEVICE_JSON)}async setDeviceJson(e){E.setItem(this.DEVICE_JSON,e)}async getRegisteredByCookie(){return E.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){E.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){E.setItem(this.LATITUDE,e)}getLatitude(){return E.getItem(this.LATITUDE)}setLongitude(e){E.setItem(this.LONGITUDE,e)}getLongitude(){return E.getItem(this.LONGITUDE)}},p=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),g=p;class m{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=g.INFO,this.setLogLevel((new I).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=g.DEBUG&&e<=g.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=g.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}i(){if(this.level<=g.INFO)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}w(){if(this.level<=g.WARNING)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}e(){if(this.level<=g.ERROR)for(let e=0;e<arguments.length;e++)this.log+=m.addedAsString(arguments[e]);return this}e(e){return this.level<=g.ERROR&&(this.log+=`${e.errorCode}: ${e.errorMessage}`),this}writeLog(){this.log.length>0&&console.log(this.tag,this.log),this.log=[]}}const R=m,_=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},A=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new _(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new _(GENERAL_ERROR,"general error",s)}}},T={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},O=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const n=new R("[IND]BaseClient: ");let o=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(o=o.replace("v1","v2"));const r={method:e,headers:s.addHeaders()};e!==this.GET&&(r.body=JSON.stringify(s.getBody())),i&&(r.credentials=i);try{const t=await fetch(o,r),i=await t.json();return t.ok?(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog(),new _(t.status,t.statusText))}catch(t){return n.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),A.showError(T,T.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},P=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new I).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},S=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new I).getBrowserPublicKey(),this.browserPrivateKey=(new I).getBrowserPrivateKey(),this.platform=(new I).getPlatform(),this.version=(new I).getVersion(),this.browserName=(new I).getBrowserName(),this.browserVersion=(new I).getBrowserVersion(),this.osName=(new I).getOsName(),this.osVersion=(new I).getOsVersion(),this.deviceType=(new I).getDeviceType(),(new I).getEnabled()&&(this.enabled="true"===(new I).getEnabled()),(new I).getExternalId()&&(this.externalCode=(new I).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new I).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new I).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}static setDeviceJson(e){(new I).setDeviceJson(JSON.stringify(e.toJSON()))}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},f=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),y=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),w=class{static isServiceTimestampExceed(){return!(new I).getServiceTimestamp()||(new I).getServiceSyncTime()<=(Date.now()-(new I).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},v=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new R("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},C=new R("[IND]Crypto"),D=new TextEncoder("utf-8"),b="HMAC",U=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",D.encode(e),{name:b,hash:{name:"SHA-256"}},!1,["sign","verify"]),n=await s.sign(b,i,D.encode(t)),o=new Uint8Array(n),r=Array.prototype.map.call(o,(e=>("00"+e.toString(16)).slice(-2))).join("");return C.d("hmac: ",r).writeLog(),r}catch(e){return void C.e("error:",e).writeLog()}}},L=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},B=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},M={Repository:I,Config:l,Api:i,Models:n,Utils:o}},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.1.0","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";s.r(i),s.d(i,{default:()=>$});const{Repository:e}=s(635).Core,t=new class extends e{constructor(){super(),this.INAPP_ENABLED=this.REPOSITORY+".INAPP_ENABLED",this.URL_INAPP_API=this.REPOSITORY+".URL_INAPP_API",this.INAPP_SHOW_ONCE=this.REPOSITORY+".INAPP_SHOW_ONCE",this.INAPP_TIMES_CLICKED=this.REPOSITORY+".INAPP_TIMES_CLICKED",this.INAPP_DISMISS_FOREVER=this.REPOSITORY+".INAPP_DISMISS_FOREVER",this.INAPP_TOPICS=this.REPOSITORY+".INAPP_TOPICS",this.URL_DEVICE_API=this.REPOSITORY+".URL_DEVICE_API"}setItemStorage(e){this.setItemSessionStorage(this.REPOSITORY,e)}getItemStorage(){return this.getItemSessionStorage(this.REPOSITORY)}setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}setInAppEnabled(e){this.setStorage(this.INAPP_ENABLED,e)}getInAppEnabled(){return this.getStorage(this.INAPP_ENABLED)}getUrlInappApi(){return this.getStorage(this.URL_INAPP_API)}setUrlInappApi(e){this.setStorage(this.URL_INAPP_API,e)}getInAppShowOnce(){return this.getStorage(this.INAPP_SHOW_ONCE)}setInAppShowOnce(e){this.setStorage(this.INAPP_SHOW_ONCE,e)}getInAppTimesClicked(){return this.getStorage(this.INAPP_TIMES_CLICKED)}setInAppTimesClicked(e){this.setStorage(this.INAPP_TIMES_CLICKED,e)}getInAppDismissForever(){return this.getStorage(this.INAPP_DISMISS_FOREVER)}setInAppDismissForever(e){this.setStorage(this.INAPP_DISMISS_FOREVER,e)}getInAppTopics(){return this.getStorage(this.INAPP_TOPICS)}setInAppTopics(e){this.setStorage(this.INAPP_TOPICS,e)}async getUrlDeviceApi(){let e;try{this.storage&&this.storage.isLocalStorageAvailable()?e=this.getStorage(this.URL_DEVICE_API):this.db&&this.db.IDB&&(e=await this.db.getItem(this.URL_DEVICE_API))}catch(e){}return e}},{Validations:n,Log:o}=s(635).Core.Utils,r=class extends n{static isAppKeyFormat(){const e=t.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new o("[IND]InAppValidations: "),s=t.getDeviceId();let i=!0;return this.isAppKeyFormat()||(i=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(s)||(i=!1,e.w("deviceId is null or empty").writeLog()),i}},{ErrorDictionary:a}=s(635).Core.Models,l=a.ErrorCode;Object.assign(l,{INAPP_ERROR:2e3,INAPP_SHOW_INAPP_ERROR:2100,INAPP_WAS_EXPIRED:2101,INAPP_WAS_SHOWN_MANY_TIMES:2102,INAPP_WAS_CLICKED_MANY_TIMES:2103,INAPP_FORM_TYPE_NOT_CORRECT:2120,INAPP_FORM_FIELD_IS_EMPTY:2121,INAPP_POPUP_ERROR:2300,INAPP_WAS_DISMISSED_FOREVER:2304,INAPP_ERROR_CONTENT_MESSAGE:2305,INAPP_INSTANCE_TOPICS_ERROR:2306,INAPP_GENERAL_ERROR:2600});const c=a.ErrorMessage;Object.assign(c,{INAPP_ERROR:"inApp error",INAPP_SHOW_INAPP_ERROR:"error on show inApp",INAPP_WAS_EXPIRED:"InApp was expired",INAPP_WAS_SHOWN_MANY_TIMES:"InApp was shown more than $x times",INAPP_WAS_CLICKED_MANY_TIMES:"InApp was clicked more than $x times",NAPP_FORM_TYPE_NOT_CORRECT:"Input type is not correct",INAPP_FORM_FIELD_IS_EMPTY:"Field is empty",INAPP_POPUP_ERROR:"error on popup",INAPP_WAS_DISMISSED_FOREVER:"InApp was dismissed forever",INAPP_ERROR_CONTENT_MESSAGE:"InApp error with content",INAPP_INSTANCE_TOPICS_ERROR:"topics instance is not correct, only string[] is valid types",INAPP_GENERAL_ERROR:"inApp general error"});const E={ErrorCode:l,ErrorMessage:c},h=class{static searchInApp(e){const t=this.getListInApp();return null==t?null:this.findInAppFromInAppList(t,e)}static searchInAppWithInAppId(e){const t=this.getListInApp();return null==t?null:this.findInAppFromInAppListWithInAppId(t,e)}static addInApp(e){let s=this.getListInApp();null!=s?s.push(e):s=[e],t.setItemStorage(JSON.stringify(s))}static getListInApp(){let e=null;try{t.getItemStorage()&&(e=JSON.parse(t.getItemStorage()))}catch(e){console.error(e.message)}return e}static addInAppNewClick(e){this.updateInAppField(e.inAppId,!0,null,null)}static addInAppNewShow(e){this.updateInAppField(e.inAppId,null,!0,null)}static addInAppDismissForever(e){this.updateInAppField(e.inAppId,null,null,!0)}static updateInAppField(e,s,i,n){const o=this.getListInApp(),r=[];if(null!=o)for(let t=0;t<o.length;t++)o[t].inAppId==e&&(null!=s&&(o[t].inAppShow.timesClicked+=1),null!=i&&(o[t].inAppShow.timesShowed+=1),null!=n&&(o[t].inAppShow.wasDismissed=!0)),r.push(o[t]);t.setItemStorage(JSON.stringify(r))}static deleteInApp(e){const s=this.getListInApp(),i=[];if(null!=s)for(let t=0;t<s.length;t++)s[t].inAppId!=e.inAppId&&i.push(s[t]);t.setItemStorage(JSON.stringify(i))}static findInAppFromInAppListWithInAppId(e,t){if(null!=e)for(let s=0;s<e.length;s++)if(e[s].inAppId&&e[s].inAppId==t)return e[s];return null}static findInAppFromInAppList(e,t){if(null!=e)for(let s=0;s<e.length;s++)if(console.log("gcf inapp find2 "+e[s].schema.code,t),e[s].schema.code&&e[s].schema.code==t)return e[s];return null}static findInAppFromInAppListWithInAppId(e,t){if(null!=e)for(let s=0;s<e.length;s++)if(console.log("gcf findInAppFromInAppListWithInAppId "+e[s].inAppId,t),e[s].inAppId&&e[s].inAppId==t)return e[s];return null}},d=class{constructor(e){this.URL="url",e.actionId&&(this.actionId=e.actionId),e.destroy&&(this.destroy=e.destroy),e.topics&&(this.topics=e.topics),e.type&&(this.type=e.type),e.url&&(this.url=e.url),e.no_action&&(this.no_action=e.no_action)}},u=class{constructor(e){if(e.cacheTtl&&(this.cacheTtl=e.cacheTtl),e.inAppId&&(this.inAppId=e.inAppId),e.showOnce&&(this.showOnce=e.showOnce),e.version&&(this.version=e.version),e.customData&&(this.customData=e.customData),e.creationDate?this.creationDate=e.creationDate:this.creationDate=f.getDate((new Date).getTime()),e.expiredDate)this.expiredDate=e.expiredDate;else{let e=24192e5;this.cacheTtl&&(e=60*this.cacheTtl*60*1e3),this.expiredDate=f.getDate((new Date).getTime()+e)}e.schema&&(this.schema=new class{constructor(e){e.code&&(this.code=e.code),e.width&&(this.width=e.width),e.height&&(this.height=e.height)}}(e.schema)),e.properties&&(this.properties=new class{constructor(e){e.contentUrl&&(this.contentUrl=e.contentUrl),e.showTime&&(this.showTime=e.showTime),e.numberOfShows&&(this.numberOfShows=e.numberOfShows),e.numberOfClicks&&(this.numberOfClicks=e.numberOfClicks),e.dismissForever&&(this.dismissForever=e.dismissForever),e.layout&&(this.layout=new class{constructor(e){e.borderRadius&&(this.borderRadius=e.borderRadius)}}(e.layout)),e.action&&(this.action=new d(e.action))}setAction(e){this.action=e}}(e.properties)),this.inAppShow=new class{constructor(e){this.timesShowed=0,this.timesClicked=0,this.wasDismissed=!1,e&&(e.timesShowed&&(this.timesShowed=e.timesShowed),e.timesClicked&&(this.timesClicked=e.timesClicked),e.wasDismissed&&(this.wasDismissed=e.wasDismissed))}}(e.inAppShow)}},{BaseRequest:I}=s(635).Core.Api,{Config:p}=s(635).Core,g=class extends I{constructor(){super()}setEventType(e){this.eventType=e}setInAppId(e){this.inAppId=e}setActionId(e){this.actionId=e}setClickedButton(e){this.clickedButton=e}setLastVersionId(e){this.lastVersionId=e}setVersion(e){this.version=e}setDeviceId(e){this.deviceId=e}setPlatform(e){this.platform=e}postEventPrintRequest(){const e=this.fillJsonEventRequest();return this.body=e,this}postEventClickRequest(){const e=this.fillJsonEventRequest();return e.actionId=this.actionId,this.body=e,this}fillJsonEventRequest(){const e={};return t.getDeviceId()&&(e.deviceId=t.getDeviceId()),t.getExternalId()&&(e.externalId=t.getExternalId()),e.inAppId=this.inAppId,e.platform=p.platform,e.version=this.version,e}postEventInAppRequest(){const e={};return e.inAppId=this.inAppId,e.lastVersionId=this.lastVersionId,e.deviceId=this.deviceId,this.eventType&&(e.eventType=this.eventType),e.platform=this.platform,e.clickedButton=this.clickedButton,this.body=e,this}},{BaseRequest:m}=s(635).Core.Api,R=class extends m{constructor(){super(),null!=t.getExternalId()&&(this.customerId=t.getExternalId()),null!=t.getDeviceId()&&(this.deviceId=t.getDeviceId())}setFields(e){this.fields=e}putCustomerFieldRequest(){return this.params=this.createQueryStringCustomerId(),this.body=this.createBodyJson(),this}createQueryStringCustomerId(){return this.PARAM_CUSTOMER_ID+"="+this.customerId}createBodyJson(){let e={};try{e.channel="inapp",this.device&&(e.deviceId=this.device.deviceId),this.customerId&&(e.customerId=this.customerId),this.fields&&(e=this.fields)}catch(e){console.log("Error fieldNames request :"+e)}return e}},{BaseRequest:_}=s(635).Core.Api,{Config:A}=s(635).Core,T=class extends _{constructor(){super()}setInAppId(e){this.inAppId=e}setVersion(e){this.version=e}setJsonForm(e){this.jsonForm=e}postForm(){return this.body=this.createBody(),this}createBody(){const e={};return t.getDeviceId()&&(e.deviceId=t.getDeviceId()),t.getExternalId()&&(e.externalCode=t.getExternalId()),this.jsonForm&&(e.form=this.jsonForm),e.inAppId=this.inAppId,e.platform=A.platform,e.version=this.version,e}},O=class{static sendEventPrint(e){const t=new g;t.setInAppId(e.inAppId),t.setVersion(e.version),b.postEventPrint(t)}static sendEventClick(e){const t=new g;t.setActionId(e.properties.action.actionId),t.setInAppId(e.inAppId),t.setVersion(e.version),b.postEventClick(t)}static sendEventForm(e,t,s){const i=new T;i.setVersion(t),i.setInAppId(e),i.setJsonForm(s),b.postEventForm(i)}static sendEventFormToCustomer(e){const t=new R;t.setFields(e),b.putCustomerField(t)}},{Log:P,ErrorUtils:S,CommonUtils:N}=s(635).Core.Utils,f=class{constructor(){this.MONTH=24192e5}static async inAppWasShown(e,t,s,i,n){const o=new P("[IND]InAppUtils: ");e.schema.code&&this.inAppWasGot(e.schema.code,t,(e=>{N.isFunction(n)&&n(e)}),(()=>{N.isFunction(n)&&n(e)}),((e,t)=>{o.d("inAppWasShown: "+e.inAppId+" with error: "+t.errorMessage).writeLog()}),s,i)}static async inAppWasGot(e,t,s,i,n,o,r){const a=h.searchInApp(e),l=(new Date).getTime();if(null!=a){const e=new u(a);if(l<new Date(e.expiredDate).getTime()){if(e.properties.dismissForever&&e.inAppShow.wasDismissed)N.isFunction(n)&&n(e,S.showError(E,E.INAPP_POPUP_ERROR));else{const t=e.properties.numberOfShows,s=e.inAppShow?e.inAppShow.timesShowed:null,i=e.properties.numberOfClicks,n=e.inAppShow?e.inAppShow.timesClicked:null;if(t>0){if(!(s&&s<t))return void(N.isFunction(o)&&o(e,S.showError(E,E.ErrorCode.INAPP_WAS_SHOWN_MANY_TIMES)));h.addInAppNewShow(e)}if(i>0&&n&&n>=i)return void(N.isFunction(r)&&r(e,S.showError(E,E.ErrorCode.INAPP_WAS_CLICKED_MANY_TIMES)))}return void(N.isFunction(s)&&s(e))}N.isFunction(t)&&t(e,S.showError(E,E.ErrorCode.INAPP_WAS_EXPIRED))}else N.isFunction(i)&&i()}static addNewInApp(e){h.addInApp(e)}static addNewInAppClick(e){e.properties.numberOfClicks&&e.properties.numberOfClicks>0&&h.addInAppNewClick(e),O.sendEventClick(e)}static addNewInApptoDismissForever(e){h.addInAppDismissForever(e)}static isInAppDismissForever(e){const t=h.searchInAppWithInAppId(e.inAppId);return!(null==t||!new u(t).inAppShow.wasDismissed)}static async convertToJSONArray(e){if(e&&""!=e)return await Promise.resolve(e).then((e=>JSON.parse(e)))}static getDate(e){const t=new Date(e);let s=""+(t.getMonth()+1),i=""+t.getDate();const n=t.getFullYear();let o=t.getHours(),r=t.getMinutes(),a=t.getSeconds();return s.length<2&&(s="0"+s),i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),`${n}-${s}-${i} ${o}:${r}:${a}`}},{BaseClient:y}=s(635).Core.Api,{Config:w}=s(635).Core,{ErrorModel:v}=s(635).Core.Models,{CommonUtils:C,ErrorUtils:D}=s(635).Core.Utils,b=new class extends y{constructor(){super(),this.ENDPOINT_INAPP="/inapp",this.URL_BASE=w.client.URL_DEVICE_V2+this.ENDPOINT_INAPP,this.ENDPOINT_CAMPAIGN="/campaign",this.ENDPOINT_CAMPAIGN_TAG=this.ENDPOINT_CAMPAIGN+"/{tag}",this.ENDPOINT_EVENT_INAPP="/event",this.ENDPOINT_EVENT_INAPP_PRINT=this.ENDPOINT_EVENT_INAPP+"/print",this.ENDPOINT_EVENT_INAPP_CLICK=this.ENDPOINT_EVENT_INAPP+"/click",this.ENDPOINT_EVENT_INAPP_FORM=this.ENDPOINT_EVENT_INAPP+"/form",this.ENDPOINT_DEVICE="/device",this.ENDPOINT_DEVICE_TOPICS=this.ENDPOINT_DEVICE+"/topics",this.ENDPOINT_CUSTOMER="/customer",this.ENDPOINT_CUSTOMER_FIELD=this.ENDPOINT_CUSTOMER+"/field",this.isCustomerRequest=!1}async getURL(){if(this.isCustomerRequest)return this.isCustomerRequest=!1,await t.getUrlDeviceApi()||w.client.CUSTOMER_URL_BASE;const e=await t.getUrlInappApi();return e?e+this.ENDPOINT_INAPP:this.URL_BASE}async getCampaignTag(e,t,s){const i=await this.get(this.ENDPOINT_CAMPAIGN_TAG,e.getCampaignTagRequest());if(!i||i instanceof v&&i.data!={})i?C.isFunction(s)&&s(i):C.isFunction(s)&&s(D.showError(E,E.ErrorCode.INAPP_ERROR_CONTENT_MESSAGE));else if(C.isFunction(t)){const e={inAppId:i.data.inAppId,version:i.data.version,showOnce:i.data.showOnce,creationDate:f.getDate((new Date).getTime()),expiredDate:i.data.cacheTtl?f.getDate((new Date).getTime()+60*i.data.cacheTtl*1e3):f.getDate((new Date).getTime()+(new f).MONTH),properties:i.data.properties,renewalTime:i.data.renewalTime,schema:i.data.schema};f.addNewInApp(new u(e)),t(e)}return null}async getInAppTopics(e,t,s){if(r.isAppKeyFormat()){const i=await this.get(this.ENDPOINT_DEVICE_TOPICS,e.getDeviceTopicsRequest());if(!i||i instanceof v)i?C.isFunction(s)&&s(i):C.isFunction(s)&&s();else{const e=i.data.topics;C.isFunction(t)&&t(e)}}else C.isFunction(s)&&s(D.showError(E,E.ErrorCode.INAPP_GENERAL_ERROR));return!0}postEventClick(e){r.isAppKeyFormat()&&this.post(this.ENDPOINT_EVENT_INAPP_CLICK,e.postEventClickRequest())}postEventPrint(e){r.isAppKeyFormat()&&this.post(this.ENDPOINT_EVENT_INAPP_PRINT,e.postEventClickRequest())}postEventForm(e){r.isAppKeyFormat()&&this.post(this.ENDPOINT_EVENT_INAPP_FORM,e.postForm())}putCustomerField(e){r.isAppKeyFormat()&&(this.isCustomerRequest=!0,this.put(this.ENDPOINT_CUSTOMER_FIELD,e.putCustomerFieldRequest()))}},{BaseRequest:U}=s(635).Core.Api,L=class extends U{constructor(){super(),this.PARAM_DEVICE_TYPE="deviceType",this.PARAM_EXTERNAL_CODE="externalCode",this.PARAM_BROWSER_NAME="browerName"}setTag(e){this.tag=e}getCampaignTagRequest(){return this.params=this.createQueryString(),this.pathParams["{tag}"]=this.tag,this}createQueryString(){let e="";return null!=t.getDeviceId()&&(e+=`${this.PARAM_DEVICE_ID}=${t.getDeviceId()}&`),null!=t.getExternalId()&&(e+=`${this.PARAM_EXTERNAL_CODE}=${t.getExternalId()}&`),null!=t.getDeviceType()&&(e+=`${this.PARAM_DEVICE_TYPE}=${t.getDeviceType()}&`),null!=t.getBrowserName()&&(e+=`${this.PARAM_BROWSER_NAME}=${t.getBrowserName()}&`),null!=t.getLatitude()&&(e+=`${this.PARAM_LATITUDE}=${t.getLatitude()}&`),null!=t.getLongitude()&&(e+=`${this.PARAM_LONGITUDE}=${t.getLongitude()}&`),null!=t.getInAppTopics()&&0!==t.getInAppTopics().length&&(e+=`${this.PARAM_TOPICS}=${t.getInAppTopics()}&`),e+=`${this.PARAM_PLATFORM}=webpush`,e}},{BaseRequest:B}=s(635).Core.Api,M=class extends B{constructor(){super()}getDeviceTopicsRequest(){return this.PARAM_DEVICE_ID+"="+t.getDeviceId()}},{CommonUtils:F,ErrorUtils:V}=s(635).Core.Utils,x=class{static saveTopics(e,s,i){if(e instanceof Array){let i=[];if(null!=t.getInAppTopics()&&(i=t.getInAppTopics()),0!==i.length){const t=e.filter((e=>!i.includes(e)));0!==t.length&&i.push(t)}else for(let t=0;t<e.length;t++)i.push(e[t]);t.setInAppTopics(i),F.isFunction(s)&&s(i)}else F.isFunction(i)&&i(V.showError(E,E.ErrorCode.INAPP_INSTANCE_TOPICS_ERROR))}static deleteTopics(e,s,i){if(e instanceof Array){let i=[];if(null!=t.getInAppTopics()&&(i=t.getInAppTopics()),0!==i.length){const s=e.filter((e=>!i.includes(e)));0!==s.length&&t.setInAppTopics(s)}F.isFunction(s)&&s(i)}else F.isFunction(i)&&i(V.showError(E,E.ErrorCode.INAPP_INSTANCE_TOPICS_ERROR))}},Y=new class{constructor(){this.sliderScript=' let slideIndex = 1;\n        showSlides(slideIndex);\n        let timeSlide = 10000;\n        \n        const slider = document.querySelector(\'.slider-container-actions\');\n        let sliderTotal = document.getElementsByClassName("slideshow-item").length;\n        let slides = document.getElementsByClassName("slideshow-item");\n        \n        var interval = setInterval(() => {\n            newSlide();\n        }, timeSlide);\n        \n        var startMove = null;\n        \n        slider.addEventListener(\'touchstart\', handleStart, false);\n        slider.addEventListener(\'touchend\', handleEnd, false);\n        slider.addEventListener(\'mousedown\', mouseStart);\n        slider.addEventListener(\'mouseup\', mouseEnd);\n        \n        function mouseStart(evt) {\n            evt.preventDefault();\n            startMove = evt.clientX;\n        }\n        \n        function mouseEnd(evt) {\n            evt.preventDefault();\n            var endMove = evt.clientX;\n            setEndMove(endMove);\n        }\n        \n        function handleStart(evt) {\n            evt.preventDefault();\n            startMove = evt.touches[0].clientX;\n        }\n        function handleEnd(evt) {\n            evt.preventDefault();\n            var endMove = evt.changedTouches[0].pageX;\n            setEndMove(endMove);\n        }\n        \n        function setEndMove(endMove) {\n            if (startMove != null) {\n                if (startMove > endMove) {\n                    slideIndex++;\n                    if (slideIndex > sliderTotal) {\n                        slideIndex = 1;\n                    }\n                } else {\n                    if (slideIndex == 0) {\n                        slideIndex = sliderTotal;\n                    } else {\n                        slideIndex--;\n                    }\n                }\n                showSlides(slideIndex );\n               setNewInterval();\n            } \n        }\n          \n        function plusSlides(n) {\n          showSlides(slideIndex += n);\n          setNewInterval();\n        }\n        \n        function currentSlide(n) {\n          showSlides(slideIndex = n);\n          \n        }\n        \n        function setNewInterval() {\n          clearInterval(interval);\n          interval = setInterval(() => {\n            newSlide();\n          }, timeSlide);\n        }\n        \n        function newSlide(){\n            slideIndex++;\n            if (slideIndex > sliderTotal) {\n                slideIndex = 1;\n            }\n            showSlides(slideIndex);\n        }\n        \n        function showSlides(n) {\n          let i;\n          let slides = document.getElementsByClassName("slideshow-item");\n          let dots = document.getElementsByClassName("dot");\n          if (n > slides.length) {slideIndex = 1;}    \n          if (n < 1) {slideIndex = slides.length;}\n          for (i = 0; i < slides.length; i++) {\n            slides[i].style.display = "none";  \n          }\n          for (i = 0; i < dots.length; i++) {\n            dots[i].className = dots[i].className.replace(" active", "");\n          }\n          slides[slideIndex-1].style.display = "block";  \n          dots[slideIndex-1].className += " active";\n        }\n  ',this.script=" \n          function inAppIndigitallOnClick(action) {\n                 InAppIndigitallInterface.onClick(action);                 \n          }\n          function inAppIndigitallSubmit(formOptions) {\n              const jsonForm = {}\n              const jsonCustomer = {}\n              const form = document.querySelector('[id=\"'+formOptions.formId+'\"]');\n              if (form) {\n                  formOptions.inputs.forEach((el) => {\n                      let value;\n                      if (el.type === 'text' || el.type === 'number') {\n                          if (form && form.querySelector('input[id^=\"'+el.id+'\"]')) {\n                              value = form.querySelector('input[id^=\"'+el.id+'\"]').value;            \n                          }            \n                      }\n                      if (el.type === 'checkbox') {\n                          if (form && form.querySelectorAll('input[id^=\"'+el.id +'\"]')) {\n                              let values = form.querySelectorAll('input[id^=\"'+el.id +'\"]');\n                              var valuesChecked = [];\n                              for (var i = 0; i < values.length; i++) {\n                                  if (values[i].checked) {\n                                      valuesChecked.push(values[i].value);                                \n                                  }                                        \n                              }\n                              value = valuesChecked;\n                          }\n                      }\n                      if (el.type === 'radio') {\n                          if (form && form.querySelectorAll('input[id^=\"'+el.id +'\"]')) {\n                              let values = form.querySelectorAll('input[id^=\"'+el.id +'\"]');\n                              var valuesChecked;\n                              for (var i = 0; i < values.length; i++) {\n                                  if (values[i].checked) {\n                                      valuesChecked = values[i].value;                                \n                                  }                                        \n                              }\n                              value = valuesChecked;\n                          }\n                      }\n                      if (el.type === 'select') {\n                          if (form && form.querySelector('select[id^=\"'+el.id+'\"]')) {\n                              value = form.querySelector('select[id^=\"'+el.id+'\"]').value;            \n                          }\n                      }       \n                      if (value) jsonForm[el.id] = value;\n                      if (el.sendToCustomer) jsonCustomer[el.id] = value;                    \n                  })\n              }\n              InAppIndigitallInterface.submit(JSON.stringify(formOptions), JSON.stringify(jsonForm), JSON.stringify(jsonCustomer));\n          }\n          ",this.htmlTest="\n          <!DOCTYPE html>\n          <html lang=\"en\" dir=\"ltr\">\n            <head>\n              <meta charset=\"utf-8\" />\n              <meta name=\"viewport\" content=\"width=device-width\" />\n              <title>guille test</title>\n              <style>\n                html,\n                body {\n                  margin: 0;\n                  padding: 0;\n                  height: 100%;\n                  width: 100%;\n                }\n                body p:first-child {\n                  margin: 0;\n                }\n              </style>\n            </head>\n            <body>\n              \n      <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n        <html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\" xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\">\n          <head>\n            <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n            \x3c!--[if !mso]>\x3c!--\x3e\n            \x3c!--[if (gte mso 9)|(IE)]>\x3c!--\x3e\n            <link href=\"https://fonts.googleapis.com/css2?family=EB+Garamond&family=Merriweather&family=Montserrat&family=Open+Sans&family=Oswald&family=Playfair+Display&family=Raleway&family=Roboto&family=Roboto+Slab&family=Source+Sans+Pro&display=swap\" rel=\"stylesheet\">\n            \x3c!--<![endif]--\x3e\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            \x3c!--<![endif]--\x3e\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <link href=\"http://fonts.cdnfonts.com/css/arial\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/courier-new\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/georgia-2\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/trebuchet-ms-2\" rel=\"stylesheet\">\n            <link href=\"http://fonts.cdnfonts.com/css/verdana-pro-cond\" rel=\"stylesheet\">\n                    \n            <link href=\"https://fonts.googleapis.com/css2?family=EB+Garamond&family=Merriweather&family=Montserrat&family=Open+Sans&family=Oswald&family=Playfair+Display&family=Raleway&family=Roboto&family=Roboto+Slab&family=Source+Sans+Pro&display=swap\" rel=\"stylesheet\">\n            <title>InApp Sample</title>\n            \n            <style type=\"text/css\">\n              html {\n              width: 100%;\n              height: 100%;\n              }\n              @font-face {\n                font-family: 'Merriweather';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/merriweather/v28/u-440qyriQwlOrhSvowK_l5OeA.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Montserrat';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/montserrat/v23/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Ew9.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Open Sans';\n                font-style: normal;\n                font-weight: 400;\n                font-stretch: normal;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/opensans/v28/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4k.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Oswald';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/oswald/v47/TK3_WkUHHAIjg75cFRf3bXL8LICs1_FvgUI.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Playfair Display';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/playfairdisplay/v28/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvUDT.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Raleway';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/raleway/v26/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaooCM.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Roboto';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Me5g.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Roboto Slab';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISWaw.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'Source Sans Pro';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/sourcesanspro/v19/6xK3dSBYKcSV-LCoeQqfX1RYOo3aPA.woff) format('woff');\n              }\n              @font-face {\n                font-family: 'EB Garamond';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/ebgaramond/v24/SlGDmQSNjdsmc35JDF1K5E55YMjF_7DPuGi-6_RUAA.woff) format('woff');\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Merriweather';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/merriweather/v28/u-440qyriQwlOrhSvowK_l5-ciZMZ-Y.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Merriweather';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/merriweather/v28/u-440qyriQwlOrhSvowK_l5-fCZM.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Montserrat';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/montserrat/v23/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Hw3aXpsog.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Montserrat';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/montserrat/v23/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Hw5aXo.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Open Sans';\n                font-style: normal;\n                font-weight: 400;\n                font-stretch: 100%;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/opensans/v28/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4uaVIGxA.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Open Sans';\n                font-style: normal;\n                font-weight: 400;\n                font-stretch: 100%;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/opensans/v28/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4gaVI.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Oswald';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/oswald/v47/TK3_WkUHHAIjg75cFRf3bXL8LICs1_FvsUhiZTaR.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Oswald';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/oswald/v47/TK3_WkUHHAIjg75cFRf3bXL8LICs1_FvsUZiZQ.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Playfair Display';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/playfairdisplay/v28/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvXDZbtPY_Q.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Playfair Display';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/playfairdisplay/v28/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKdFvXDXbtM.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Raleway';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/raleway/v26/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaorCGPrEHJA.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Raleway';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/raleway/v26/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaorCIPrE.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Roboto';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKOzY.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Roboto';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxK.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Roboto Slab';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISmYWRjRdE.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Roboto Slab';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/robotoslab/v22/BngbUXZYTXPIvIBgJJSb6s3BzlRRfKOFbvjojISmb2Rj.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'Source Sans Pro';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/sourcesanspro/v19/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lqDY.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'Source Sans Pro';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/sourcesanspro/v19/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7l.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n              /* latin-ext */\n              @font-face {\n                font-family: 'EB Garamond';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/ebgaramond/v24/SlGDmQSNjdsmc35JDF1K5E55YMjF_7DPuGi-6_RkCo9_S6w.woff2) format('woff2');\n                unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;\n              }\n              /* latin */\n              @font-face {\n                font-family: 'EB Garamond';\n                font-style: normal;\n                font-weight: 400;\n                font-display: swap;\n                src: url(https://fonts.gstatic.com/s/ebgaramond/v24/SlGDmQSNjdsmc35JDF1K5E55YMjF_7DPuGi-6_RkBI9_.woff2) format('woff2');\n                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n              }\n      \n            </style>\n            <style>\n              .slideshow-item {\n                cursor: grabbing;\n                scroll-snap-align: start;\n                display: none; \n                scroll-snap-type: x mandatory;\n                scroll-behavior: smooth;\n                -webkit-overflow-scrolling: touch; /* For mobile */\n                -ms-overflow-style: none; /* For hide scrollbar */\n                scrollbar-width: none; /* For hide scrollbar */\n              }\n              .slideshow-item-preview {\n                cursor: grabbing;\n                scroll-snap-align: start;\n                display: block; \n                scroll-snap-type: x mandatory;\n                scroll-behavior: smooth;\n                -webkit-overflow-scrolling: touch; /* For mobile */\n                -ms-overflow-style: none; /* For hide scrollbar */\n                scrollbar-width: none; /* For hide scrollbar */\n              }\n              img {vertical-align: middle;}\n              \n              /* Slideshow container */\n              .slideshow-container {\n              /*   max-width: 1000px; */\n                position: relative;\n                margin: auto;\n                -webkit-overflow-scrolling: touch; /* For mobile */\n              }\n              \n              /* Next & previous buttons */\n              .prev, .next {\n                cursor: pointer;\n                position: absolute;\n                top: 50%;\n                width: auto;\n                padding: 16px;\n                margin-top: -22px;\n                color: white;\n                font-weight: bold;\n                font-size: 18px;\n                transition: 0.6s ease;\n                border-radius: 0 3px 3px 0;\n                user-select: none;\n              }\n              \n              /* Position the \"next button\" to the right */\n              .next {\n                right: 0;\n                border-radius: 3px 0 0 3px;\n              }\n              \n              /* On hover, add a black background color with a little bit see-through */\n              .prev:hover, .next:hover {\n                background-color: rgba(0,0,0,0.8);\n              }\n              \n              .points {\n                padding: 8px 12px;\n                position: absolute;\n                bottom: 8px;\n                text-align: center;\n                width:100%;\n              }\n              \n              /* The dots/bullets/indicators */\n              .dot {\n                cursor: pointer;\n                height: 15px;\n                width: 15px;\n                margin: 0 2px;\n                background-color: #bbb;\n                border-radius: 50%;\n                display: inline-block;\n                transition: background-color 0.6s ease;\n              }\n              \n              .active, .dot:hover {\n                background-color: #717171;\n              }\n              \n              /* On smaller screens, decrease text size */\n              @media only screen and (max-width: 300px) {\n                .prev, .next,.text {font-size: 11px}\n              }\n          </style>\n            \n          </head>\n          <body style=\"margin:0; height: 100%; width: 100%;\">\n            <div style=\"\n                background-color: rgba(244, 244, 244, 1);\n                width: 100%;\n                height: 100%;\n                margin: 0 auto;\n              \">\n              \n            <div style=\"\n          display: flex;\n          flexDirection: row;\n          box-sizing: border-box;\n          padding: 0px 0px 0px 0px ;\n          margin: 0px 0px 0px 0px ;\n          background-color: rgba(244, 244, 244, 0);\n          border: 0px solid rgba(244, 244, 244, 0);\n          width: 100%;\">\n              \n                <div style=\"\n          width: 100%;\n        \">\n                  \n                        <div style=\"\n                            margin: 0px 0px 0px 0px ;\n                            padding: 15px 15px 15px 15px ;\n                            background-color: rgba(244, 244, 244, 0);\n                            text-align: left;\n                            font-family: 'Roboto';\n                          \">\n                          \n          <form id=\"5kZSrg6xbKyX\" class=\"form-style-1\">\n            \n        <style type=\"text/css\">\n          .form-style-1 {\n          }\n          .form-style-1 li {\n            padding: 0;\n            display: block;\n            list-style: none;\n            margin: 10px 0 0 0;\n          }\n          .form-style-1 label{\n            margin:0 0 3px 0;\n            padding:0px;\n            display:block;\n            font-weight: bold;\n          }\n          .form-style-1 input[type=text], \n          .form-style-1 input[type=date],\n          .form-style-1 input[type=datetime],\n          .form-style-1 input[type=number],\n          .form-style-1 input[type=search],\n          .form-style-1 input[type=time],\n          .form-style-1 input[type=url],\n          .form-style-1 input[type=email],\n          textarea, \n          select{\n            box-sizing: border-box;\n            -webkit-box-sizing: border-box;\n            -moz-box-sizing: border-box;\n            border:1px solid #BEBEBE;\n            padding: 7px;\n            margin:0px;\n            -webkit-transition: all 0.30s ease-in-out;\n            -moz-transition: all 0.30s ease-in-out;\n            -ms-transition: all 0.30s ease-in-out;\n            -o-transition: all 0.30s ease-in-out;\n            outline: none;\n          }\n          .form-style-1 input[type=text]:focus, \n          .form-style-1 input[type=date]:focus,\n          .form-style-1 input[type=datetime]:focus,\n          .form-style-1 input[type=number]:focus,\n          .form-style-1 input[type=search]:focus,\n          .form-style-1 input[type=time]:focus,\n          .form-style-1 input[type=url]:focus,\n          .form-style-1 input[type=email]:focus,\n          .form-style-1 textarea:focus, \n          .form-style-1 select:focus{\n            -moz-box-shadow: 0 0 8px #88D5E9;\n            -webkit-box-shadow: 0 0 8px #88D5E9;\n            box-shadow: 0 0 8px #88D5E9;\n            border: 1px solid #88D5E9;\n          }\n          .form-style-1 .field-divided{\n            width: 49%;\n          }\n      \n          .form-style-1 .field-long{\n            width: 100%;\n          }\n          .form-style-1 .field-select{\n            width: 100%;\n          }\n          .form-style-1 .field-textarea{\n            height: 100px;\n          }\n          \n          .form-style-1 input[type=submit]:hover, .form-style-1 input[type=button]:hover{\n            background: #4691A4;\n            box-shadow:none;\n            -moz-box-shadow:none;\n            -webkit-box-shadow:none;\n          }\n          .form-style-1 input[type=radio]{\n            transform: scale(1.2);\n          }\n          .form-style-1 input[type=checkbox]{\n            transform: scale(1.2);\n          }\n          .form-style-1 .required{\n            color:red;\n          }\n          </style>\n        \n            \n          <div style=\"margin-top: 10px;\">\n            <label>\n              Escribe algo\n              <span class=\"required\">*</span>\n            </label>\n            <input type=\"text\" name=\"algo\" id=\"algo\" required=\"true\" sendToCustomer=\"true\" style=\"width: 100%;\n        padding: 12px 20px;\n        margin: 8px 0;\n        display: inline-block;\n        border: 1px solid #ccc;\n        border-radius: 4px;\n        box-sizing: border-box;\">\n          </div><div style=\"margin-top: 10px;\">\n          <label style=\"\n          margin:0 0 3px 0;\n          padding:0px;\n          display:block;\n        \">\n            Selecciona algo\n            \n          </label>\n          <select style=\"width: 100%;\n          padding: 12px 20px;\n          margin: 8px 0;\n          display: inline-block;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          box-sizing: border-box;\" id=\"selector\" required=\"undefined\" sendToCustomer=\"true\">\n            <option value=\"algo\">Algo</option><option value=\"masalgo\">Mas algo</option><option value=\"variosalgos\">Varios algos</option>\n          </select>\n        </div>\n          <div style=\"\n          margin-top: 10px;\n        \">\n            <label style=\"\n          margin-bottom: 10px;\n        \">\n              ¿Cuál de las dos opciones te gusta más?\n              \n            </label>\n            \n                <div style=\"margin-bottom: 5px; display: flex; flex-direction: row; align-items: baseline; gap:0px;\">\n                  <input style=\"margin-right: 10px;\" type=\"radio\" id=\"radio0\" name=\"radio\" value=\"opcion1\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"radio0\">Opcion 1</label>\n                </div>\n              \n                <div style=\"margin-bottom: 5px; display: flex; flex-direction: row; align-items: baseline; gap:0px;\">\n                  <input style=\"margin-right: 10px;\" type=\"radio\" id=\"radio1\" name=\"radio\" value=\"opcion2\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"radio1\">Opcion 2</label>\n                </div>\n              \n          </div>\n        \n        <div style=\"margin-top: 10px;\">\n          <label style=\"\n          margin-bottom: 10px;\n        \">\n            Marca las casillas que quieras\n            \n          </label>\n          \n              <div style=\"display: flex; flex-direction: row; margin-bottom: 5px; align-items: flex-start;\">\n                <input style=\"margin-right: 10px;\" type=\"checkbox\" id=\"casilla0\" name=\"casilla\" value=\"casilla1\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"casilla0\">Casilla 1</label>\n              </div>\n            \n              <div style=\"display: flex; flex-direction: row; margin-bottom: 5px; align-items: flex-start;\">\n                <input style=\"margin-right: 10px;\" type=\"checkbox\" id=\"casilla1\" name=\"casilla\" value=\"casilla2\"><label style=\"font-weight: 100; margin-right: 10px;\" for=\"casilla1\">Casilla 2</label>\n              </div>\n            \n        </div>\n            \n          <tr style=\"\n              display: block;\n              text-align: left; \">\n            <td style=\"\n                display: inline-block;\n                width: auto;\n                padding: 15px 15px 15px 15px ;\n                margin: 0px 0px 0px 0px ;\n                background-color: rgba(244, 244, 244, 0);\">\n              <div target=\"_blank\" rel=\"noreferrer\" onclick=\"InAppIndigitall.submit({'schemaId':217,'inAppId':22,'inputs':[{'type':'text','label':'Escribe algo','name':'algo','subtype':'text','required':true,'sendToCustomer':true,'id':'algo'},{'type':'select','label':'Selecciona algo','name':'selector','options':[{'name':'Algo','value':'algo'},{'name':'Mas algo','value':'masalgo'},{'name':'Varios algos','value':'variosalgos'}],'sendToCustomer':true,'id':'selector'},{'type':'radio','label':'¿Cuál de las dos opciones te gusta más?','name':'radio','options':[{'name':'Opcion 1','value':'opcion1'},{'name':'Opcion 2','value':'opcion2'}],'labelPosition':'right','id':'radio'},{'type':'checkbox','label':'Marca las casillas que quieras','options':[{'name':'Casilla 1','value':'casilla1'},{'name':'Casilla 2','value':'casilla2'}],'subtype':'right','name':'casilla','id':'casilla'}],'formId':'5kZSrg6xbKyX'})\" style=\"text-decoration: none; width: auto; cursor: pointer;\">\n                <div style=\"\n                    padding: 8px 16px 8px 16px;\n                    width: auto;\n                    display: inline-block;\n                    text-align: left;\n                    background-color: rgba(200, 200, 200, 1);\n                    border-radius: 3px 3px 3px 3px;\n                    border: 0px solid transparent;\n                    box-sizing: border-box;\n                    margin-top: 15px;\">\n                  <span style=\"text-align: center; \"><span style=\"font-size: 16px\"><span style=\"font-family: Roboto, sans-serif !important\"><span style=\"color: #555555\"><span style=\"background-color: transparent\"><span style=\"letter-spacing: 0px;\">Botón</span></span></span></span></span></span>\n                </div>\n              </div>\n            </td>\n          </tr>\n        \n            </form>\n            \n                        </div>\n                      \n                </div>\n            </div>\n            </div>\n          </body>\n        </html>\n              <script>\n                // Created event\n                var event = document.createEvent('Event');\n            \n                /* defined event 'click'.*/\n                event.initEvent('click', true, true);\n            \n                // to assign event click.\n                document.addEventListener('click', function (e) {\n                  window.parent.document.dispatchEvent(new CustomEvent('indigitall_on_click_inapp', {detail: {\n                    inAppId: 217,\n                    lastVersionId: 431,\n                    clickedButton: 'content',\n                    action: {\n                        type: 'url',\n                        url: 'https://indigitall.com'\n                    }\n                  }}));\n                }, false);\n              <\/script>\n            </body>\n          </html>\n           \n         "}},k=Object.freeze({TEXT:"text",NUMBER:"number",RADIO:"radio",CHECKBOX:"checkbox",SELECT:"select"}),K=class{constructor(e){if(e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.type)switch(e.type){case"text":this.type=k.TEXT;break;case"checkbox":this.type=k.CHECKBOX;break;case"number":this.type=k.NUMBER;break;case"radio":this.type=k.RADIO;break;case"select":this.type=k.SELECT}e.required&&(this.required=e.required),e.sendToCustomer&&(this.sendToCustomer=e.sendToCustomer)}},{ErrorUtils:G}=s(635).Core.Utils,q=class{static checkFieldsForm(e,t,s){const i=[];if(null!=t&&e.inputs&&e.inputs.length>0)for(let s=0;s<e.inputs.length;s++){const n=this.checkInputType(e.inputs[s],t);null!=n&&i.push(n)}if(i.length>0)return i;null!=t&&O.sendEventForm(e.inAppId,e.inappVersion,t),null!=s&&O.sendEventFormToCustomer(s)}static checkInputType(e,t){if(null!=e.id)switch(e.type){case k.TEXT:if(e.required){if(!t[e.id])return G.showError(E,2121,e.id);if(!t[e.id]instanceof String)return G.showError(E,2120,`The field ${e.id} is not text`)}break;case k.NUMBER:if(e.required){if(!t[e.id])return G.showError(E,2121,e.id);if(!t[e.id]instanceof String){if(!parseInt(t[e.id]))return G.showError(E,2120,`The field ${e.id} is not number`)}else if(!t[e.id]instanceof int)return G.showError(E,2120,`The field ${e.id} is not number`)}break;default:if(e.required&&t[e.id]&&""==t[e.id])return G.showError(E,2121,e.id)}return null}static editingFormHtml(e){return e.replace("InAppIndigitall.onClick","inAppIndigitallOnClick").replace("InAppIndigitall.submit","inAppIndigitallSubmit")}},{EventType:j}=s(635).Core.Models,{Log:W,ErrorUtils:J,CommonUtils:X,CorePermissions:H,LogLevel:Q}=s(635).Core.Utils,z="[IND]InAppIndigitall: ";class Z{constructor(){this.LogLevel=Q}static async init(e){let s=new W(z);null!=e.appKey&&t.setAppKey(e.appKey),e.urlInAppApi&&t.setUrlInappApi(e.urlInAppApi),e.logLevel&&(t.setLogLevel(e.logLevel),s=new W(z)),await H.getPermissions(),navigator.geolocation.getCurrentPosition((e=>{t.setLatitude(e.coords.latitude),t.setLongitude(e.coords.longitude)}),(e=>{s.e("error "+e).writeLog(),t.getPermissionLocation()||t.getPermissionLocation()==j.EVENT_TYPE_REJECT||t.setPermissionLocation(j.EVENT_TYPE_REJECT)}))}static async showInApp(e,s,i,n){const o={appKey:t.getAppKey(),urlInAppApi:"https://device-api.indigitall.com/v2",requestLocation:!0,logLevel:Q.DEBUG,inAppCode:e,viewId:s};this.showInAppWithConfig(o,null,null,null,null,null,null,i,n,null)}static async showInAppWithConfig(e,t,s,i,n,o,a,l,c,h){await this.init(e),r.isAppKeyFormat()?f.inAppWasGot(e.inAppCode,s,(async s=>{s&&s.properties&&this.createInApp(s,e.viewId,a,l,c,t,h)}),(()=>{this.drawInApp(e.inAppCode,e.viewId,t,a,l,c,h)}),o,i,n):X.isFunction(c)&&c(J.showError(E,E.ErrorCode.BAD_REQUEST_SERVER_ERROR))}static showMultipleInApp(e,s,i,n){const o={appKey:t.getAppKey(),urlInAppApi:"https://device-api.indigitall.com/v2",requestLocation:!0,logLevel:Q.DEBUG,inAppCodeList:e,divList:s};this.showMultipleInAppWithConfig(o,null,null,null,null,null,null,i,n,null)}static async showMultipleInAppWithConfig(e,t,s,i,n,o,a,l,c,h){if(await this.init(e),r.isAppKeyFormat()){if(e.inAppCodeList.length==e.divList.length&&e.inAppCodeList.length>0)for(var d=0;d<e.inAppCodeList.length;d++)f.inAppWasGot(e.inAppCodeList[d],s,(async s=>{s&&s.properties&&this.createInApp(s,e.divList[d],a,l,c,t,h)}),(()=>{Z.drawInApp(e.inAppCodeList[d],e.divList[d],t,a,l,c,h)}),o,i,n)}else X.isFunction(c)&&c(J.showError(E,E.ErrorCode.BAD_REQUEST_SERVER_ERROR))}static async drawInApp(e,t,s,i,n,o,r){this.getInApp(e,(async e=>{e&&e.properties&&this.createInApp(e,t,i,n,o,s,r)}),o)}static async createInApp(e,t,s,i,n,o,r){if(e&&e.properties&&e.properties.contentUrl)try{const n=document.getElementById(t);n.style.position="relative",n.style.overflow="hidden";const a=await fetch(e.properties.contentUrl),l=await a.text();let c=l;null!=e.customData&&Object.keys(e.customData).forEach((function(t){c=l.replaceAll(t,e.customData[t])})),e.version&&(c=c.replaceAll("'inappVersion':'{{version}}'","'inappVersion':"+e.version));const E=document.createElement("script");E.innerHTML=Y.script,document.head.appendChild(E);const h=q.editingFormHtml(c);if(n.innerHTML=h,self.addEventListener("didClicked",(function(e){s&&s()})),self.addEventListener("didFormError",(function(t){console.log("gcf send event error1",e,t.detail.errorList),r&&r(e,t.detail.errorList)})),e.properties.showTime){let t=0;const s=setInterval((function(){t++,t==parseInt(e.properties.showTime)&&(n.style.display="none",clearInterval(s),X.isFunction(o)&&o(e,n,1e3*e.properties.showTime))}),1e3)}if(e.properties.layout&&e.properties.layout.borderRadius){const t=`${parseInt(e.properties.layout.borderRadius)}px`;n.style.borderRadius=t}X.isFunction(i)&&(i(e,n),O.sendEventPrint(e))}catch(e){X.isFunction(n)&&n(e)}}static topicsList(e,t){return b.getInAppTopics(new M,e,t),!0}static async topicsSubscribe(e,t,s){x.saveTopics(e,t,s)}static async topicsUnsubscribe(e,t,s){x.deleteTopics(e,t,s)}static inAppGet(e,t,s){this.getInApp(e,t,s)}static getInApp(e,t,s){if(r.isAppKeyFormat()){const i=new L;i.setTag(e),b.getCampaignTag(i,t,s)}else X.isFunction(s)&&s(J.showError(E,E.ErrorCode.BAD_REQUEST_SERVER_ERROR))}static addNewInAppToDismissForever(e){f.addNewInApptoDismissForever(e)}static async isInAppDismissForever(e){f.isInAppDismissForever(e)}static async inAppWasShown(e,t,s,i,n){f.inAppWasShown(e,t,s,i,n)}static async downloadHTML(e){const t=await fetch(e,{method:"GET"});console.log(t)}}const $=Z;window.indigitall||(window.indigitall={}),window.indigitall.InApp=Z,window.indigitall.InApp.Utils=f,window.indigitall.LogLevel=Q,window.InAppIndigitallInterface=class{static onClick(e){if(e){const t=JSON.parse(e);let s;t.inAppId&&(s=t.inAppId),t.inappId&&(s=t.inappId);const i=h.searchInAppWithInAppId(s);if(i&&t.action){const e=new u(i),s=new d(t.action);if(e.properties.setAction(s),s.type==s.URL&&window.open(s.url),e){f.addNewInAppClick(e);const t=new CustomEvent("didClicked",{detail:{},bubbles:!0,cancelable:!0,composed:!1});self.dispatchEvent(t)}}else console.log(`InApp ${t.schema} not found`)}else console.log("InApp action is empty")}static submit(e,t,s){if(null!=e){const i=new class{constructor(e){if(e.inAppId&&(this.inAppId=e.inAppId),e.formId&&(this.formId=e.formId),e.inappVersion&&(this.inappVersion=e.inappVersion),e.inputs&&Array.isArray(e.inputs)){this.inputs=[];for(let t=0;t<e.inputs.length;t++)this.inputs.push(new K(e.inputs[t]))}}}(JSON.parse(e));if(null!=t){const e=q.checkFieldsForm(i,JSON.parse(t),JSON.parse(s));if(e&&e.length>0){const t=new CustomEvent("didFormError",{detail:{errorList:e},bubbles:!0,cancelable:!0,composed:!1});self.dispatchEvent(t)}}}}static test(){console.log("gcf test indigitall interface")}}})(),i})(),e.exports=t()},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.1.0","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";s.r(n);var e=s(253),t=s.n(e);const{Repository:o}=s(828).Core;const r=new class extends o{constructor(){super(),this.AUTH_TOKEN=this.REPOSITORY+".AUTH_TOKEN",this.INBOX_AUTH_MODE=this.REPOSITORY+".INBOX_AUTH_MODE",this.URL_INBOX_API=this.REPOSITORY+".URL_INBOX_API"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}setAuthToken(e){this.setStorage(this.AUTH_TOKEN,e)}getAuthToken(){return this.getStorage(this.AUTH_TOKEN)}setInboxAuthMode(e){this.setStorage(this.INBOX_AUTH_MODE,e)}getInboxAuthMode(){return this.getStorage(this.INBOX_AUTH_MODE)}async getUrlInboxApi(){return this.getStorage(this.URL_INBOX_API)}async setUrlInboxApi(e){this.setStorage(this.URL_INBOX_API,e)}},{BaseClient:a}=s(828).Core.Api,{Config:l}=s(828).Core,{ErrorModel:c}=s(828).Core.Models,{CommonUtils:E}=s(828).Core.Utils;const h=new class extends a{constructor(){super(),this.URL_BASE=l.client.INBOX_URL_BASE,this.ENDPOINT_INBOX_NOTIFICATIONS="/notification",this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID=this.ENDPOINT_INBOX_NOTIFICATIONS+"/{sendingId}",this.ENDPOINT_INBOX_COUNTER="/counters",this.ENDPOINT_INBOX_AUTH="/auth/webhook"}async getURL(){const e=await r.getUrlInboxApi();return e||this.URL_BASE}async postInboxAuth(e,t,s){const i=await this.post(this.ENDPOINT_INBOX_AUTH,e.postInboxAuth());if(!i||i instanceof c||!i.data)i?E.isFunction(s)&&s(i):E.isFunction(s)&&s();else{const e=i.data.token;r.setAuthToken(e),E.isFunction(t)&&t(i)}return!0}async getInbox(e,t,s){const i=await this.get(this.ENDPOINT_INBOX_NOTIFICATIONS,e.getInboxPushRequest());return this.getInboxResponseStatus(i,t,s),!0}async putInboxPush(e,t,s){const i=await this.put(this.ENDPOINT_INBOX_NOTIFICATIONS,e.putInboxPushRequest());return this.getInboxResponseEdit(i,t,s),!0}async getInboxPushWithSendingId(e,t,s,i){const n=await this.get(this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID,e.getInboxPushRequestWithSendingId());return this.getNotificationResponseStatus(n,t,s,i),!0}async putInboxPushWithSendingId(e,t,s,i){const n=await this.put(this.ENDPOINT_INBOX_NOTIFICATIONS_WITH_SENDINGID,e.putInboxWithSendingId());return this.getNotificationResponseStatus(n,t,s,i),!0}async getInboxCounter(e,t,s){const i=await this.get(this.ENDPOINT_INBOX_COUNTER,e.getCounter());this.getCounterStatus(i,t,s)}async getInboxResponseStatus(e,t,s){if(e&&!(e instanceof c)&&e.statusCode>=200&&e.statusCode<300){const s=new L(e.data);E.isFunction(t)&&t(s)}else e?E.isFunction(s)&&s(e):E.isFunction(s)&&s()}async getInboxResponseEdit(e,t,s){e&&!(e instanceof c)&&e.statusCode>=200&&e.statusCode<300?E.isFunction(t)&&t():e?E.isFunction(s)&&s(e):E.isFunction(s)&&s()}getNotifications(e,t){const s=[];for(let i=0;i<e.length;i++){null!=e[i].sentAt&&null!=t&&e[i].sentAt<t&&(read=!0);const n=new InboxNotification(e[i],t);s.push(n)}return s}async getNotificationResponseStatus(e,t,s,n){if(e&&!(e instanceof c)&&e.statusCode>=200&&e.statusCode<300){const e=new InboxNotification(notifications[i],t);E.isFunction(s)&&s(e)}else e?E.isFunction(n)&&n(e):E.isFunction(n)&&n()}async getCounterStatus(e,t,s){if(e&&!(e instanceof c)&&e.statusCode>=200&&e.statusCode<300){const s={click:e.data.click,sent:e.data.sent,deleted:e.data.deleted,unread:this.getUnreadCounters(e.data.unread)};E.isFunction(t)&&t(s)}else e?E.isFunction(s)&&s(e):E.isFunction(s)&&s()}getUnreadCounters(e){return{count:e.count,lastAccess:e.lastAccess}}},{BaseRequest:d}=s(828).Core.Api;const u=class extends d{constructor(){super()}postInboxAuth(){return this.body=this.json,this}setJson(e){this.json=e}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}},I=Object.freeze({SENT:"sent",CLICK:"click",DELETED:"deleted"});window.inboxStatus=I;const p=I,g=Object.freeze({NONE:"none",DEFAULT:"default",WEBHOOK:"webhook"}),{BaseRequest:m}=s(828).Core.Api;const R=class extends m{constructor(){super(),null!=r.getExternalId()&&(this.externalId=r.getExternalId()),null!=r.getAuthToken()&&r.getInboxAuthMode()==g.WEBHOOK&&(this.headers.Authorization="Bearer "+r.getAuthToken()),this.sendingId="",this.sendingIds=null,this.page=0,this.pageSize=0,this.dateFrom="",this.dateTo="",this.status=p.INBOXSTATUS_SENT,this.statusList=null}getInboxPushRequest(){return this.params=this.createQueryString(),this}putInboxPushRequest(){return this.params=this.createQueryStringExternalId(),this.body=this.createBodyJson(),this}getInboxPushRequestWithSendingId(){return this.pathParams["{sendingId}"]=this.sendingId,this.params=this.createQueryStringExternalId(),this}putInboxWithSendingId(){return this.pathParams["{sendingId}"]=this.sendingId,this.params=this.createQueryStringExternalId(),this.body=this.createBodyStatusJson(),this}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}createQueryString(){let e="";if(this.page&&(e+=this.PARAM_INBOX_PAGE+"="+this.page+"&"),this.pageSize&&(e+=this.PARAM_INBOX_PAGE_SIZE+"="+this.pageSize+"&"),this.dateFrom&&(e+=this.PARAM_INBOX_DATE_FROM+"="+this.dateFrom+"&"),this.dateTo&&(e+=this.PARAM_INBOX_DATE_TO+"="+this.dateTo+"&"),this.statusList){let t="";for(let e=0;e<this.statusList.length;e++)t+=this.statusList[e],e!=this.statusList.length-1&&(t+=",");e+=this.PARAM_INBOX_STATUS+"="+t+"&"}return e+this.createQueryStringExternalId()}createQueryStringExternalId(){return this.PARAM_INBOX_EXTERNALID+"="+this.externalId}createBodyJson(){let e={};const t=[];try{if(e=this.createBodyStatusJson(),this.sendingIds)for(let e=0;e<this.sendingIds.length;e++)t.push(this.sendingIds[e]);e.sendingIds=t}catch(e){console.log("Error Inbox request :"+e)}return e}createBodyStatusJson(){const e={};return this.status&&(e.status=this.status),e}setSendingId(e){this.sendingId=e}setSendingIds(e){this.sendingIds=e}setPage(e){this.page=e}setPageSize(e){this.pageSize=e}setDateFrom(e){this.dateFrom=e}setDateTo(e){this.dateTo=e}setStatus(e){this.status=e}setStatusList(e){this.statusList=e}},{BaseRequest:_}=s(828).Core.Api;const A=class extends _{constructor(){super(),null!=r.getExternalId()&&(this.externalId=r.getExternalId()),null!=r.getAuthToken()&&r.getInboxAuthMode()==g.WEBHOOK&&(this.headers.Authorization="Bearer "+r.getAuthToken())}getCounter(){return this.params=this.createQueryStringExternalId(),this}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}createQueryStringExternalId(){return this.PARAM_INBOX_EXTERNALID+"="+this.externalId}};class T{constructor(e,t){e&&(e.id&&(this.id=e.id),e.externalId&&(this.externalId=e.externalId),e.sentAt&&(this.sentAt=e.sentAt),e.status&&(this.status=e.status),e.sendingId&&(this.sendingId=e.sendingId),e.message&&(this.message=e.message),e.campaignId&&(this.campaignId=e.campaignId),this.read=!1,this.sentAt&&t&&this.sentAt<t&&(this.read=!0))}}window.inboxNotification=T;const O=T,{ErrorDictionary:P}=s(828).Core.Models,S=P.ErrorCode;Object.assign(S,{INBOX_GET_ERROR:3001,INBOX_GET_PAGE_ERROR:3011,INBOX_EXTERNAL_ID_NO_REGISTERED:3012,INBOX_NO_MESSAGES:3013,INBOX_IS_REQUESTING_PAGE:3014,INBOX_EMPTY:3015,INBOX_GENERAL_ERROR:3600});const N=P.ErrorMessage;Object.assign(N,{INBOX_GET_ERROR:"inbox GET request error",INBOX_GET_PAGE_ERROR:"error inbox get page",INBOX_EXTERNAL_ID_NO_REGISTERED:"external Id is not registered",INBOX_NO_MESSAGES:"There are no more messages on Inbox",INBOX_IS_REQUESTING_PAGE:"Wait. Is Requesting new page",INBOX_EMPTY:"There are no messages on Inbox",INBOX_GENERAL_ERROR:"general error"});const f={ErrorCode:S,ErrorMessage:N},{Validations:y,Log:w}=s(828).Core.Utils;const v=class extends y{static isAppKeyFormat(){const e=r.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new w("[IND]InboxValidations: "),t=r.getDeviceId();let s=!0;return this.isAppKeyFormat()||(s=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(t)||(s=!1,e.w("deviceId is null or empty").writeLog()),s}},{CommonUtils:C,ErrorUtils:D,Log:b}=s(828).Core.Utils;class U{constructor(e){if(e){if(e.lastAccess&&(this.lastAccess=e.lastAccess),e.numPage?this.page=e.numPage:this.page=0,e.pageSize&&(this.pageSize=e.pageSize),e.count&&(this.count=e.count),e.notifications){this.notifications=[];const t=e.notifications;for(let e=0;e<t.length;e++){const s=new O(t[e],this.lastAccess);this.notifications.push(s)}}this.totalPages=Math.trunc(this.count/this.pageSize)}this.dateFrom=null,this.dateTo=null,this.statusList=null,this.newNotifications=[O],this.isRequestingPage=!1}static generateAuthToken(e,t){let s={};navigator.indigitallGetAuthConfig&&C.isFunction(navigator.indigitallGetAuthConfig)&&(s=navigator.indigitallGetAuthConfig());const i=new u;i.setJson(s),h.postInboxAuth(i,e,t)}static getMessagesCount(e,t){if(v.isValidFormatRequest())if(v.isValidFormat(r.getExternalId())){const t=new A;h.getInboxCounter(t,e,(s=>{401===s.errorCode?this.generateAuthToken((()=>{h.getInboxCounter(t,e,s)}),s):C.isFunction(s)&&s(s)}))}else C.isFunction(t)&&t(D.showError(f,f.ErrorCode.INBOX_GET_ERROR));else C.isFunction(t)&&t(D.showError(f,f.ErrorCode.GENERAL_ERROR_BAD_REQUEST))}static getInbox(e,t){U.getInboxWithPage(null,null,null,null,null,e,t)}static getInboxWithPage(e,t,s,i,n,o,a){if(v.isValidFormatRequest())if(v.isValidFormat(r.getExternalId())){const r=new R;e&&r.setPage(e),t&&r.setPageSize(t),s&&(r.setDateFrom(s),this.dateFrom=s),i&&(r.setDateTo(i),this.dateTo=i),n&&(r.setStatusList(n),this.statusList=n),h.getInbox(r,(e=>{this.totalPages=e.totalPages,0!=e.count?C.isFunction(o)&&o(e):C.isFunction(a)&&a(D.showError(f,f.ErrorCode.INBOX_GET_PAGE_ERROR))}),(e=>{401==e.errorCode?this.generateAuthToken((()=>{h.getInbox(r,(e=>{this.totalPages=e.totalPages,C.isFunction(o)&&o(e)}),e)}),e):C.isFunction(e)&&e(e)}))}else C.isFunction(a)&&a(D.showError(f,f.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(a)&&a(D.showError(f,f.ErrorCode.GENERAL_ERROR_BAD_REQUEST))}getNextPage(e,t){const s=new b("[IND]Inbox: ");if(this.isRequestingPage)s.w(f.ErrorMessage.INBOX_IS_REQUESTING_PAGE).writeLog();else if(this.isRequestingPage=!0,this.page+1<this.totalPages)if(v.isValidFormatRequest())if(v.isValidFormat(r.getExternalId())){const t=new R;(this.page||0==this.page)&&t.setPage(this.page+1),this.pageSize&&t.setPageSize(this.pageSize),this.dateFrom&&t.setDateFrom(this.dateFrom),this.dateTo&&t.setDateTo(this.dateTo),this.statusList&&t.setStatusList(this.statusList),h.getInbox(t,(t=>{this.notifications=this.notifications.concat(t.notifications),this.newNotifications=t.notifications,this.lastAccess=t.lastAccess,this.count=t.count,this.page=t.page,this.pageSize=t.pageSize,this.totalPages=t.totalPages,this.isRequestingPage=!1,C.isFunction(e)&&e(this,this.newNotifications)}),(s=>{401===s.errorCode?this.generateAuthToken((()=>{h.getInbox(t,(t=>{this.notifications=this.notifications.concat(t.notifications),this.newNotifications=t.notifications,this.lastAccess=t.lastAccess,this.count=t.count,this.page=t.page,this.pageSize=t.pageSize,this.totalPages=t.totalPages,this.isRequestingPage=!1,C.isFunction(e)&&e(this,this.newNotifications)}),s)}),s):(this.isRequestingPage=!1,C.isFunction(s)&&s())}))}else this.isRequestingPage=!1,C.isFunction(t)&&t(D.showError(f,f.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(t)&&t(D.showError(f,f.ErrorCode.GENERAL_ERROR_BAD_REQUEST));else this.isRequestingPage=!1,C.isFunction(t)&&t(D.showError(f,f.ErrorCode.INBOX_NO_MESSAGES))}massiveEditNotifications(e,t,s,i){if(v.isValidFormatRequest())if(v.isValidFormat(r.getExternalId())){if(e&&t){const i=new R;i.setSendingIds(e),i.setStatus(t),h.putInboxPush(i,s,(e=>{401===e.errorCode?this.generateAuthToken((()=>{h.putInboxPush(i,s,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(i)&&i(D.showError(f,f.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(i)&&i(D.showError(f,f.ErrorCode.BAD_REQUEST_SERVER_ERROR))}getInfoFromNotification(e,t,s){if(v.isValidFormatRequest())if(v.isValidFormat(r.getExternalId())){if(e){const s=new R;s.setSendingId(e),h.getInboxPushWithSendingId(s,this.lastAccess,t,(e=>{401===e.errorCode?this.generateAuthToken((()=>{h.getInboxPushWithSendingId(s,this.lastAccess,t,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(s)&&s(D.showError(f,f.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(s)&&s(D.showError(f,f.ErrorCode.BAD_REQUEST_SERVER_ERROR))}modifyStatusFromNotification(e,t,s,i){if(v.isValidFormatRequest())if(v.isValidFormat(r.getExternalId())){if(e&&t){const i=new R;i.setSendingId(e),i.setStatus(t),h.putInboxPushWithSendingId(i,this.lastAccess,s,(e=>{401===e.errorCode?this.generateAuthToken((()=>{h.putInboxPushWithSendingId(i,this.lastAccess,s,e)}),e):C.isFunction(e)&&e(e)}))}}else C.isFunction(i)&&i(D.showError(f,f.ErrorCode.INBOX_EXTERNAL_ID_NO_REGISTERED));else C.isFunction(i)&&i(D.showError(f,f.ErrorCode.BAD_REQUEST_SERVER_ERROR))}}const L=U,{Repository:B}=s(828).Core;const M=new class extends B{constructor(){super(),this.SAFARI_WEBSITE_PUSH_ID=this.REPOSITORY+".SAFARI_WEBSITE_PUSH_ID",this.PUSH_TOKEN=this.REPOSITORY+".PUSH_TOKEN",this.PERMISSION_PUSH=this.REPOSITORY+".PERMISSION_PUSH",this.URL_DEVICE_API=this.REPOSITORY+".URL_DEVICE_API",this.DEVICE_JSON=this.REPOSITORY+".DEVICE_JSON",this.PUT_REQUEST_TIMESTAMP=this.REPOSITORY+".PUT_REQUEST_TIMESTAMP"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}setPushToken(e){this.setStorage(this.PUSH_TOKEN,e)}getPushToken(){return this.getStorage(this.PUSH_TOKEN)}setSafariWebsitePushId(e){this.setStorage(this.SAFARI_WEBSITE_PUSH_ID,e)}getSafariWebsitePushId(){return this.getStorage(this.SAFARI_WEBSITE_PUSH_ID)}setPermissionPush(e){this.setStorage(this.PERMISSION_PUSH,e)}getPermissionPush(){return this.getStorage(this.PERMISSION_PUSH)}async getUrlDeviceApi(){let e;try{this.storage&&this.storage.isLocalStorageAvailable()?e=this.getStorage(this.URL_DEVICE_API):this.db&&this.db.IDB&&(e=await this.db.getItem(this.URL_DEVICE_API))}catch(e){}return e}async setUrlDeviceApi(e){this.storage&&this.storage.isLocalStorageAvailable()&&this.setStorage(this.URL_DEVICE_API,e),this.db&&this.db.IDB&&await this.db.setItem(this.URL_DEVICE_API,e)}async getDeviceJson(){return this.getStorage(this.DEVICE_JSON)}async setDeviceJson(e){this.setStorage(this.DEVICE_JSON,e)}async getPutRequestTimestamp(){return this.getStorage(this.PUT_REQUEST_TIMESTAMP)}async setPutRequestTimestamp(e){this.setStorage(this.PUT_REQUEST_TIMESTAMP,e)}},{ErrorDictionary:F}=s(828).Core.Models,V=F.ErrorCode;Object.assign(V,{GENERAL_ERROR_BAD_REQUEST:601,GENERAL_ERROR_APPKEY_BAD_REQUEST:602,PUSH_INITIALIZATION_ERROR:1e3,PUSH_RECEPTION_ERROR:1200,PUSH_TOPICS_ERROR:1400,PUSH_DEVICE_ERROR:1500,PUSH_EVENT_ERROR:1600,API_APPKEY_NOT_VALID:1601});const x=F.ErrorMessage;Object.assign(x,{GENERAL_ERROR_BAD_REQUEST:"AppKey or DeviceId are null or empty",GENERAL_ERROR_APPKEY_BAD_REQUEST:"AppKey is null or empty",PUSH_INITIALIZATION_ERROR:"initialization error",PUSH_RECEPTION_ERROR:"push reception error",PUSH_TOPICS_ERROR:"push topics error",PUSH_DEVICE_ERROR:"device error",PUSH_EVENT_ERROR:"event error",API_APPKEY_NOT_VALID:"appKey is missing'"});const Y={ErrorCode:V,ErrorMessage:x},{BaseRequest:k}=s(828).Core.Api,{EventType:K}=s(828).Core.Models;const G=class extends k{constructor(){super()}setEventType(e){this.eventType=e}setPushId(e){this.pushId=e}setClickedButton(e){this.clickedButton=e}setSendingId(e){this.sendingId=e}setPermissionType(e){this.permissionType=e}setLocation(e,t){this.latitude=e,this.longitude=t}setDeviceId(e){this.deviceId=e}setPlatform(e){this.platform=e}setAppKey(e){this.appKey=e}setCustomData(e){this.customData=e}async setExternalCodeRequest(){this.externalCode=await M.getExternalIdRequest()}setExternalCode(e){this.externalCode=e}setCampaingId(e){this.campaignId=e}setJourneyStateId(e){this.journeyStateId=e}postEventPushRequest(){const e={};return e.deviceId=this.deviceId,e.platform=this.platform,this.eventType&&(e.eventType=this.eventType),this.pushId&&(e.pushId=this.pushId),e.clickedButton=this.clickedButton,null!=this.externalCode&&(e.externalCode=this.externalCode),this.sendingId&&"undefined"!=this.sendingId&&(e.sendingId=this.sendingId),this.journeyStateId&&(e.journeyStateId=this.journeyStateId),this.campaignId&&(e.campaignId=this.campaignId),this.body=e,this}postEventVisitRequest(){const e={};return e.deviceId=M.getDeviceId(),e.eventType=K.EVENT_TYPE_UPDATE,this.body=e,this}postEventPermissionRequest(){const e={};return e.deviceId=M.getDeviceId(),this.eventType&&(e.eventType=this.eventType),this.permissionType&&(e.permissionType=this.permissionType),this.body=e,this}postEventLocationRequest(){const e={};return e.deviceId=M.getDeviceId(),e.eventType=K.EVENT_TYPE_UPDATE,this.latitude&&(e.latitude=this.latitude),this.longitude&&(e.longitude=this.longitude),this.body=e,this}postEventCustomRequest(){const e={};return this.deviceId&&(e.deviceId=this.deviceId),this.eventType&&(e.eventType=this.eventType),this.customData&&(e.customData=this.customData),this.externalCode&&(e.externalCode=this.externalCode),this.body=e,this}};const q=class{static urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),s=window.atob(t),i=new Uint8Array(s.length);for(let e=0;e<s.length;++e)i[e]=s.charCodeAt(e);return i}static callEventPermission(e,t){const s=new G;s.setAppKey(M.getAppKey()),s.setDeviceId(M.getDeviceId()),s.setPermissionType(e),s.setEventType(t),se.postEventPermission(s)}static async getPutRequestTimestamp(){return await M.getPutRequestTimestamp()?M.getPutRequestTimestamp():Date.now()+6048e5}},{Validations:j,Log:W}=s(828).Core.Utils;const J=class extends j{static isAppKeyFormat(){const e=M.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new W("[IND]PushValidations: "),t=M.getDeviceId();let s=!0;return this.isAppKeyFormat()||(s=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(t)||(s=!1,e.w("deviceId is null or empty").writeLog()),s}static async isPutRequestExceed(){return await q.getPutRequestTimestamp()<=Date.now()}},{Device:X}=s(828).Core.Models;const H=class extends X{constructor(e=null,t){super(e,t),null==e?(null!=M.getDeviceId()&&(this.deviceId=M.getDeviceId()),null!=M.getPushToken()&&(this.pushToken=M.getPushToken())):t?e.deviceId&&(this.deviceId=e.deviceId,M.setDeviceId(this.deviceId)):(e.deviceId&&(this.deviceId=e.deviceId),e.pushToken&&(this.pushToken=e.pushToken))}getDeviceId(){return this.deviceId}getPushToken(){return this.pushToken}toJSON(){const e=super.toJSON();return this.deviceId&&(e.deviceId=this.deviceId),this.pushToken&&(e.pushToken=this.pushToken),e}},{Config:Q}=s(828).Core,{BaseClient:z}=s(828).Core.Api,{ErrorModel:Z}=s(828).Core.Models,{Log:$,CommonUtils:ee,ErrorUtils:te}=s(828).Core.Utils;const se=new class extends z{constructor(){super(),this.URL_BASE=Q.client.URL_BASE,this.ENDPOINT_APPLICATION="/application",this.ENDPOINT_APPLICATION_ALL=this.ENDPOINT_APPLICATION+"/all",this.ENDPOINT_DEVICE="/device",this.ENDPOINT_DEVICE_TOPICS=this.ENDPOINT_DEVICE+"/topics",this.ENDPOINT_PUSH="/push",this.ENDPOINT_EVENT="/event",this.ENDPOINT_EVENT_PUSH=this.ENDPOINT_EVENT+"/push",this.ENDPOINT_EVENT_VISIT=this.ENDPOINT_EVENT+"/visit",this.ENDPOINT_EVENT_PERMISSION=this.ENDPOINT_EVENT+"/permission",this.ENDPOINT_EVENT_LOCATION=this.ENDPOINT_EVENT+"/location",this.ENDPOINT_EVENT_CUSTOM=this.ENDPOINT_EVENT+"/custom",this.ENDPOINT_EVENT_CUSTOM_BEACON=this.ENDPOINT_EVENT_CUSTOM+"/beacon",this.ENDPOINT_BROWSER="/browser",this.log=new $("[IND]Client: ")}async getURL(){const e=await M.getUrlDeviceApi();return e||this.URL_BASE}async getApplicationAll(e,t,s){if(J.isAppKeyFormat()){const i=await this.get(this.ENDPOINT_APPLICATION_ALL,e.getApplicationRequest());!i||i instanceof Z?i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s():ee.isFunction(t)&&t(i)}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.BAD_REQUEST_SERVER_ERROR));return!0}async postDevice(e,t,s){if(J.isAppKeyFormat()){const i=await this.post(this.ENDPOINT_DEVICE,e.postDeviceRequest(),"include");if(!i||i instanceof Z)i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s();else{const e={enabled:i.data.enabled,deviceId:i.data.deviceId,registeredByCookie:i.data.registeredByCookie};await M.setDeviceId(e.deviceId),ee.isFunction(t)&&t(new H(e,!0))}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_APPKEY_BAD_REQUEST));return!0}async putDevice(e,t,s){const i=new H,n=await J.isPutRequestExceed();if(null==await M.getPutRequestTimestamp()||n)if(J.isValidFormatRequest()){M.setPutRequestTimestamp(await q.getPutRequestTimestamp());const n=await this.put(this.ENDPOINT_DEVICE,e.putDeviceRequest(i),"include");if(!n||n instanceof Z)n?ee.isFunction(s)&&s(n):ee.isFunction(s)&&s();else{const e={enabled:n.data.enabled,deviceId:n.data.deviceId,registeredByCookie:n.data.registeredByCookie};ee.isFunction(t)&&t(new H(e,!0))}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));else ee.isFunction(t)&&t(i)}async getDevice(e,t,s){if(J.isValidFormatRequest()){const i=await this.get(this.ENDPOINT_DEVICE,e.getDeviceRequest());if(!i||i instanceof Z)i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s();else{const e={enabled:i.data.enabled,deviceId:i.data.deviceId};ee.isFunction(t)&&t(new H(e,!0))}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async getDeviceTopics(e,t,s){if(J.isValidFormatRequest()){const i=await this.get(this.ENDPOINT_DEVICE_TOPICS,e.getDeviceTopicsRequest());if(!i||i instanceof Z)i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s();else{const e=i.data.topics;ee.isFunction(t)&&t(e)}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postDeviceTopics(e,t,s){if(J.isValidFormatRequest()){const i=await this.post(this.ENDPOINT_DEVICE_TOPICS,e.postDeviceTopicsRequest());if(!i||i instanceof Z)i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s();else{const e=i.data.topics;ee.isFunction(t)&&t(e)}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async deleteDeviceTopics(e,t,s){if(J.isValidFormatRequest()){const i=await this.delete(this.ENDPOINT_DEVICE_TOPICS,e.deleteDeviceTopicsRequest());if(!i||i instanceof Z)i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s();else{const e=i.data.topics;ee.isFunction(t)&&t(e)}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventPush(e){J.isValidFormatRequest()&&await this.post(this.ENDPOINT_EVENT_PUSH,e.postEventPushRequest())}postEventVisit(e){J.isValidFormatRequest()&&this.post(this.ENDPOINT_EVENT_VISIT,e.postEventVisitRequest())}postEventPermission(e){J.isValidFormatRequest()&&this.post(this.ENDPOINT_EVENT_PERMISSION,e.postEventPermissionRequest())}postEventLocation(e){J.isValidFormatRequest()&&this.post(this.ENDPOINT_EVENT_LOCATION,e.postEventLocationRequest())}async getBrowser(e,t,s){if(J.isAppKeyFormat()){const i=await this.get(this.ENDPOINT_BROWSER,e);if(!i||i instanceof Z)i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s();else{const e={browserName:i.data.browserName,browserVersion:i.data.browserVersion,deviceType:i.data.deviceType,osName:i.data.osName,osVersion:i.data.osVersion,supported:i.data.supported,platform:i.data.platform};await M.setBrowserName(e.browserName),M.setBrowserVersion(e.browserVersion),await M.setOsName(e.osName),M.setOsVersion(e.osVersion),M.setDeviceType(e.deviceType),M.setSupported(e.supported),await M.setPlatform(e.platform),ee.isFunction(t)&&t(e)}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventCustom(e,t,s){if(J.isValidFormatRequest()){const i=await this.post(this.ENDPOINT_EVENT_CUSTOM,e.postEventCustomRequest());!i||i instanceof Z?i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s():ee.isFunction(t)&&t(i)}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventCustomSync(e,t,s){if(J.isValidFormatRequest()){e=e.postEventCustomRequest();try{if(navigator&&"sendBeacon"in navigator){const s=await this.getURL()+this.ENDPOINT_EVENT_CUSTOM_BEACON+e.getParams();navigator.sendBeacon(s,JSON.stringify(e.getBody())),ee.isFunction(t)&&t()}else{const i=await this.getURL()+this.ENDPOINT_EVENT_CUSTOM+e.getParams(),n=new XMLHttpRequest;n.open("POST",i,!1),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=()=>{n.readyState===XMLHttpRequest.DONE&&(n.status>=200||n.status<300)?ee.isFunction(t)&&t():ee.isFunction(s)&&s()},n.send(JSON.stringify(e.getBody()))}}catch(e){ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.PUSH_EVENT_ERROR,e))}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventJourney(e,t,s){if(J.isValidFormatRequest()){const i=await this.post(this.ENDPOINT_PUSH+this.ENDPOINT_EVENT_CUSTOM,e.postEventCustomRequest());!i||i instanceof Z?i?ee.isFunction(s)&&s(i):ee.isFunction(s)&&s():ee.isFunction(t)&&t(i)}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}async postEventJourneySync(e,t,s){if(J.isValidFormatRequest()){e=e.postEventCustomRequest();try{let i=await this.getURL();if(i=i.replace("v1","v2"),navigator&&"sendBeacon"in navigator){const s=i+this.ENDPOINT_PUSH+this.ENDPOINT_EVENT_CUSTOM+e.getParams();navigator.sendBeacon(s,JSON.stringify(e.getBody())),ee.isFunction(t)&&t()}else{const i=await this.getURL().replace("v1","v2")+this.ENDPOINT_PUSH+this.ENDPOINT_EVENT_CUSTOM+e.getParams(),n=new XMLHttpRequest;n.open("POST",i,!1),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=()=>{n.readyState===XMLHttpRequest.DONE&&(n.status>=200||n.status<300)?ee.isFunction(t)&&t():ee.isFunction(s)&&s()},n.send(JSON.stringify(e.getBody()))}}catch(e){ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.PUSH_EVENT_ERROR,e))}}else ee.isFunction(s)&&s(te.showError(Y,Y.ErrorCode.GENERAL_ERROR_BAD_REQUEST));return!0}},{Config:ie}=s(828).Core,{BaseRequest:ne}=s(828).Core.Api;const oe=class extends ne{getApplicationRequest(){return this.params=this.PARAM_PLATFORM+"="+ie.platform,this}},{DeviceStatus:re}=s(828).Core.Models,{BaseRequest:ae}=s(828).Core.Api;const le=class extends ae{constructor(e=re.DEFAULT){super(),this.device=new H,this.status=e,this.notToUpdate=!1}setDeviceId(e){this.device&&(this.device.deviceId=e)}setAppKey(e){this.appKey=e}getDeviceRequest(){return this.params=this.createQueryString(),this}postDeviceRequest(){return this.body=this.createDeviceJson(),this.status!==re.DEFAULT&&(this.body.enabled=1===this.status),this}putDeviceRequest(e){return this.params=this.createQueryString(),this.body=this.createPUTDeviceJson(e),this.status!==re.DEFAULT&&(this.body.enabled=1===this.status),this}getDeviceTopicsRequest(){return this.params=this.createQueryString(),this}postDeviceTopicsRequest(){return this.params=this.createQueryString(),this.body=this.createTopicsJson(),this}deleteDeviceTopicsRequest(){return this.params=this.createQueryString(),this.body=this.createTopicsJson(),this}createQueryString(){return this.PARAM_DEVICE_ID+"="+this.device.deviceId}createDeviceJson(){let e={};try{e=this.device.toJSON()}catch(e){}return e}createPUTDeviceJson(e){let t={};try{H.setDeviceJson(e),t=e.toJSON()}catch(e){}return t}createTopicsJson(){const e={};return this.topics&&(e.topics=this.topics),e}getDeviceId(){return this.device.getDeviceId()}setTopics(e){this.topics=e}setExternalCode(e){this.device.setExternalCode(e)}},ce=Object.freeze({PERMISSION_TYPE_PUSH:"push",PERMISSION_TYPE_LOCATION:"location"}),{CorePermissions:Ee}=s(828).Core.Utils;const he=class{static async getPermissions(){const e=await Ee.getPermissions(),t=await Ee.getPermission("push");return t&&(e.push=t.state),null===t&&window.Notification&&window.Notification.permission&&(e.push=window.Notification.permission),e}static async setPermissionsCallback(){Ee.setPermissionsCallback(),await Ee.setCallback("push",navigator.indigitallRequestPushPermission)}},{Repository:de}=s(828).Core;const ue=new class extends de{constructor(){super(),this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}},{Validations:Ie,Log:pe}=s(828).Core.Utils;const ge=class extends Ie{static isAppKeyFormat(){const e=ue.getAppKey();return null!=e&&""!=e&&"null"!=e&&e.length>3}static isValidFormatRequest(){const e=new pe("[IND]CustomerValidations: "),t=ue.getDeviceId();let s=!0;return this.isAppKeyFormat()||(s=!1,e.w("appKey is null or empty").writeLog()),this.isValidFormat(t)||(s=!1,e.w("deviceId is null or empty").writeLog()),s}};const me=class{constructor(e){e.id&&(this.id=e.id),e.customerId&&(this.customerId=e.customerId),e.applicationId&&(this.applicationId=e.applicationId),e.createdAt&&(this.createdAt=e.createdAt),e.updatedAt&&(this.updatedAt=e.updatedAt)}getCustomerId(){return this.customerId}getApplicationId(){return this.applicationId}getId(){return this.id}getCreatedAt(){return this.createdAt}getUpdatedAt(){return this.updatedAt}toJSON(){return{id:this.id,customerId:this.customerId,applicationId:this.applicationId,createdAt:this.createdAt,updatedAt:this.updatedAt}}};const Re=class{constructor(e,t){this.customerFieldKey=e,this.customerFieldValue=t}getCustomerFieldKey(){return this.customerFieldKey}getCutomerFieldValue(){return this.customerFieldValue}toJSON(){return JSON.parse(`"${this.customerFieldKey}":"${this.customerFieldValue}"`)}},{ErrorDictionary:_e}=s(828).Core.Models,Ae=_e.ErrorCode;Object.assign(Ae,{CUSTOMER_GET_ERROR:4001,CUSTOMER_PARAMS_ERROR:4011,CUSTOMER_GENERAL_ERROR:4600,CUSTOMER_NO_EXTERNAL_CODE:4601});const Te=_e.ErrorMessage;Object.assign(Te,{CUSTOMER_GET_ERROR:"customer get error",CUSTOMER_PARAMS_ERROR:"Params are not correct",CUSTOMER_GENERAL_ERROR:"general error",CUSTOMER_NO_EXTERNAL_CODE:"no external code registered"});const Oe={ErrorCode:Ae,ErrorMessage:Te},{Config:Pe}=s(828).Core,{BaseClient:Se}=s(828).Core.Api,{ErrorModel:Ne}=s(828).Core.Models,{CommonUtils:fe,ErrorUtils:ye}=s(828).Core.Utils;const we=new class extends Se{constructor(){super(),this.URL_BASE=Pe.client.CUSTOMER_URL_BASE,this.ENDPOINT_CUSTOMER="/customer",this.ENDPOINT_CUSTOMER_FIELD=this.ENDPOINT_CUSTOMER+"/field",this.ENDPOINT_CUSTOMER_LINK=this.ENDPOINT_CUSTOMER+"/link",this.ENDPOINT_EVENT="/event",this.ENDPOINT_EVENT_JOURNEY=this.ENDPOINT_EVENT+"/custom",this.ENDPOINT_EVENT_JOURNEY_BEACON=this.ENDPOINT_EVENT_JOURNEY+"/beacon"}async getCustomer(e,t,s){if(ge.isAppKeyFormat()&&ge.isValidFormat(ue.getExternalId)){const i=await this.get(this.ENDPOINT_CUSTOMER,e.getCustomerRequest());i&&!(i instanceof Ne)&&i.statusCode>=200&&i.statusCode<300?fe.isFunction(t)&&t(new me(i.data)):i?fe.isFunction(s)&&s(i):fe.isFunction(s)&&s()}else fe.isFunction(s)&&s(ye.showError(Oe,Oe.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async getCustomerField(e,t,s){if(ge.isAppKeyFormat()&&ge.isValidFormat(ue.getExternalId)){const i=await this.get(this.ENDPOINT_CUSTOMER_FIELD,e.getCustomerFieldRequest()),n=[];for(const e in i.data)i.data.hasOwnProperty(e)&&n.push(new Re(e,i.data[e]));i&&n.length>0&&!(i instanceof Ne)&&i.statusCode>=200&&i.statusCode<300?fe.isFunction(t)&&t(n):i?fe.isFunction(s)&&s(i):fe.isFunction(s)&&s()}else fe.isFunction(s)&&s(ye.showError(Oe,Oe.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async putCustomerField(e,t,s){if(ge.isAppKeyFormat()&&ge.isValidFormat(ue.getExternalId)){const i=await this.put(this.ENDPOINT_CUSTOMER_FIELD,e.putCustomerFieldRequest());this.getCustomerResponse(i,t,s)}else fe.isFunction(s)&&s(ye.showError(Oe,Oe.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async deleteCustomerField(e,t,s){if(ge.isAppKeyFormat()&&ge.isValidFormat(ue.getExternalId)){const i=await this.delete(this.ENDPOINT_CUSTOMER_FIELD,e.deleteCustomerFieldRequest());this.getCustomerResponse(i,t,s)}else fe.isFunction(s)&&s(ye.showError(Oe,Oe.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async postCustomerLink(e,t,s){if(ge.isValidFormatRequest()&&ge.isValidFormat(ue.getExternalId)){const i=await this.post(this.ENDPOINT_CUSTOMER_LINK,e.postAndDeleteCustomerLinkRequest());this.getCustomerResponse(i,t,s)}else fe.isFunction(s)&&s(ye.showError(Oe,Oe.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async deleteCustomerLink(e,t,s){if(ge.isValidFormatRequest()&&ge.isValidFormat(ue.getExternalId)){const i=await this.delete(this.ENDPOINT_CUSTOMER_LINK,e.postAndDeleteCustomerLinkRequest());this.getCustomerResponse(i,t,s)}else fe.isFunction(s)&&s(ye.showError(Oe,Oe.ErrorCode.BAD_REQUEST_SERVER_ERROR))}async getCustomerResponse(e,t,s){e&&!(e instanceof Ne)&&e.statusCode>=200&&e.statusCode<300?fe.isFunction(t)&&(""!=e.data?t(e.data):t()):e?fe.isFunction(s)&&s(e):fe.isFunction(s)&&s()}},{BaseRequest:ve}=s(828).Core.Api,{Device:Ce}=s(828).Core.Models;const De=class extends ve{constructor(){super(),this.device=new Ce,null!=ue.getExternalId()&&(this.customerId=ue.getExternalId()),this.fieldNames,this.link,this.fields}getCustomerRequest(){return this.params=this.createQueryStringCustomerId(),this}getCustomerFieldRequest(){return this.params=this.createQueryString(),this}putCustomerFieldRequest(){return this.params=this.createQueryStringCustomerId(),this.body=this.createBodyJson(),this}deleteCustomerFieldRequest(){return this.params=this.createQueryStringCustomerId(),this.body=this.createDeleteBodyJson(),this}postAndDeleteCustomerLinkRequest(){return this.params="",this.body=this.createBodyJson(),this}createQueryString(){let e="";return e+=this.createQueryStringCustomerId(),this.fieldNames&&(e+=`&${this.PARAM_CUSTOMER_FIELD_NAMES}=${this.fieldNames}`),this.fields&&(e+=`&${this.PARAM_CUSTOMER_FIELDS}=${this.fields}`),this.link&&(e+=`&${this.PARAM_CUSTOMER_LINK}=${this.link}`),e}createQueryStringCustomerId(){return this.PARAM_CUSTOMER_ID+"="+this.customerId}createBodyJson(){let e={};try{this.channel&&(e.channel=this.channel,this.device&&(e.deviceId=this.device.deviceId),this.customerId&&(e.customerId=this.customerId)),this.link&&(e.link=this.link),this.fields&&(e=this.fields)}catch(e){console.log("Error fieldNames request :"+e)}return e}createDeleteBodyJson(){const e={},t=[];try{if(this.fieldNames){for(let e=0;e<this.fieldNames.length;e++)t.push(this.fieldNames[e]);e.fields=t}}catch(e){console.log("Error fieldNames request :"+e)}return e}setFields(e){this.fields=e}setFieldNames(e){this.fieldNames=e}setLink(e){this.link=e}setChannel(e){this.channel=e}},{CommonUtils:be,ErrorUtils:Ue}=s(828).Core.Utils;const Le=class{static async getCustomer(e,t){const s=new De;await we.getCustomer(s,e,t)}static async getCustomerInformation(e,t,s){const i=new De;null!=e&&(Array.isArray(e)?i.setFieldNames(e):be.isFunction(s)&&s(Ue.customerError(4011,Ue.CUSTOMER_ERROR_PARAMS))),await we.getCustomerField(i,t,s)}static async updateValueToCustomerFields(e,t,s){let i;try{"string"==typeof e?i=JSON.parse(i):"object"==typeof e&&(i=e)}catch(e){be.isFunction(s)&&s(Ue.customerError(4011,Ue.CUSTOMER_ERROR_PARAMS))}if(i){const e=new De;e.setFields(i),await we.putCustomerField(e,t,s)}else be.isFunction(s)&&s(Ue.customerError(4900,Ue.CUSTOMER_ERROR_PARAMS))}static async deleteValuesFromCustomerFields(e,t,s){if(Array.isArray(e)){const i=new De;i.setFieldNames(e),await we.deleteCustomerField(i,t,s)}else be.isFunction(s)&&s(Ue.customerError(4011,Ue.CUSTOMER_ERROR_PARAMS))}static async linkCustomer(e,t,s){const i=new De;i.setChannel(e),await we.postCustomerLink(i,t,s)}static async unlinkCustomer(e,t,s){const i=new De;i.setChannel(e),await we.deleteCustomerLink(i,t,s)}},{EventType:Be,DeviceStatus:Me,Channel:Fe}=s(828).Core.Models,{LogLevel:Ve,Log:xe,CommonUtils:Ye,ErrorUtils:ke,CryptoUtils:Ke}=s(828).Core.Utils,Ge="[IND]Indigitall: ";class qe{constructor(){this.config=null}static async init(e){try{let t=new xe(Ge);if(!e)return void t.w("config is not defined").writeLog();e.onPushPermissionChanged&&(e.requestPushPermission=e.onPushPermissionChanged),e.onLocationPermissionChanged&&(e.requestLocationPermission=e.onLocationPermissionChanged),this.config=e,this.config.logLevel?(M.setLogLevel(this.config.logLevel),t=new xe(Ge)):this.config.setDebugLog&&(M.setLogLevel(Ve.WARNING),t=new xe(Ge));let s="https://device-api.indigitall.com/v1",i="https://inbox-api.indigitall.com/v1";this.config.urlDeviceApi&&(s=this.config.urlDeviceApi),this.config.urlInboxApi&&(i=this.config.urlInboxApi),await M.setUrlDeviceApi(s),await r.setUrlInboxApi(i),Ye.isFunction(this.config.requestPushPermission)&&(navigator.indigitallRequestPushPermission=this.config.requestPushPermission),Ye.isFunction(this.config.requestLocationPermission)&&(navigator.indigitallRequestLocationPermission=this.config.requestLocationPermission),Ye.isFunction(this.config.onNewUserRegistered)&&(navigator.indigitallOnNewUserRegistered=this.config.onNewUserRegistered),Ye.isFunction(this.config.onInitialized)&&(navigator.indigitallOnInitialized=this.config.onInitialized),Ye.isFunction(this.config.onError)&&(navigator.indigitallOnError=this.config.onError),Ye.isFunction(this.config.onLocationUpdated)&&(navigator.indigitallOnLocationUpdated=this.config.onLocationUpdated);const n=await he.getPermissions();if(he.setPermissionsCallback(),n&&"denied"===n.push)return t.i("Push permission denied").writeLog(),Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError("Push permission denied"),!1;if(!Ye.isServiceTimestampExceed())return this.device=new H,he.getPermissions().then((e=>{Ye.isFunction(navigator.indigitallOnInitialized)&&navigator.indigitallOnInitialized(e,new H)})),t.d("Device enabled").writeLog(),!0;{let e="",s=null;if(!this.config||!this.config.appKey)return t.w("config.appKey is not defined").writeLog(),!1;if(e=this.config.appKey,this.config.requestLocation&&await M.setRequestLocation(this.config.requestLocation),this.config.workerPath&&(s=this.config.workerPath),e){if(await M.setAppKey(e),qe.isServiceWorkerSupported()||qe.isSafariPushNotificationSupported()){const e=new oe;return se.getBrowser(e,(e=>{if(e.supported){t.d("browser supported for webpush").writeLog();const e=new oe;se.getApplicationAll(e,(async e=>{if(t.d("application ",e).writeLog(),e&&e.data&&e.data.configuration){const s=e.data.configuration;t.d("configuration ",s).writeLog(),s.vapidPublic&&M.setVAPID(s.vapidPublic),s.safariWebsitePushId&&M.setSafariWebsitePushId(s.safariWebsitePushId),s.enabled&&M.setEnabled(s.enabled),s.serviceSyncTime&&M.setServiceSyncTime(s.serviceSyncTime),s.locationEnabled&&M.setLocationEnabled(s.locationEnabled),s.locationUpdateMinutes&&M.setLocationUpdateMinutes(s.locationUpdateMinutes),s.inboxAuthMode&&r.setInboxAuthMode(s.inboxAuthMode),s.inAppEnabled}const i=new le;M.getDeviceId()&&M.getPushToken()?se.putDevice(i,(e=>{try{if(Ye.isServiceTimestampExceed()){const e=new G;e.setAppKey(M.getAppKey()),e.setDeviceId(M.getDeviceId()),se.postEventVisit(e)}e.registeredByCookie?(M.setServiceTimestamp(Date.now()),he.getPermissions().then((e=>{const s=new H;s.deviceId&&t.i("deviceId:",s.deviceId).writeLog(),s.pushToken&&t.i("pushToken:",s.pushToken).writeLog(),this.config&&Ye.isFunction(navigator.indigitallOnInitialized)&&navigator.indigitallOnInitialized(e,s)}))):qe.registerForPush(s)}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}),navigator.indigitallOnError):se.postDevice(i,(e=>{try{const t=new G;t.setAppKey(M.getAppKey()),t.setDeviceId(M.getDeviceId()),se.postEventVisit(t),e.registeredByCookie?M.setServiceTimestamp(Date.now()):qe.registerForPush(s)}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}),(e=>{404===e.errorCode&&M.clearStorage(),Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(e)}))}),navigator.indigitallOnError)}else t.w("Browser not Supported").writeLog()}),navigator.indigitallOnError),!0}t.w("ServiceWorker and SafariPushNotification not supported").writeLog()}else t.w("appKey is not found").writeLog()}}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}return!1}static deviceGet(e,t){return se.getDevice(new le,e,t),!0}static deviceEnable(e,t){return se.putDevice(new le(Me.ENABLE),e,t),!0}static deviceDisable(e,t){return se.putDevice(new le(Me.DISABLE),e,t),!0}static topicsList(e,t){return se.getDeviceTopics(new le,e,t),!0}static topicsSubscribe(e,t,s){const i=new le;return i.setTopics(e),se.postDeviceTopics(i,t,s),!0}static topicsUnsubscribe(e,t,s){const i=new le;return i.setTopics(e),se.deleteDeviceTopics(i,t,s),!0}static registerForPush(e){qe.isSafariPushNotificationSupported()?qe.launchNotificationPermissionForSafari():qe.isServiceWorkerSupported()&&qe.launchNotificationPermission(e)}static isServiceWorkerSupported(){return"serviceWorker"in navigator}static isSafariPushNotificationSupported(){return"safari"in window&&"pushNotification"in window.safari}static registerServiceWorker(e){const t=new xe(Ge);let s="/service-worker.js";return e&&(s=e),navigator.serviceWorker.register(s).then((e=>(t.d("ServiceWorker registration successful with scope: "+e.scope).writeLog(),e))).catch((e=>(t.e("ServiceWorker registration failed: ",e).writeLog(),e)))}static launchNotificationPermission(e){const t=new xe(Ge);this.registerServiceWorker(e).then((e=>{try{let s;e.installing?s=e.installing:e.waiting?s=e.waiting:e.active&&(s=e.active),s&&(t.d("sw current state "+s.state).writeLog(),"activated"==s.state?qe.subscribeForPushNotification(e):("installed"==s.state&&M.getPushToken()&&e.update(),s.addEventListener("statechange",(function(s){t.d("sw statechange : "+s.target.state).writeLog(),"activated"==s.target.state&&qe.subscribeForPushNotification(e)}))))}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}))}static subscribeForPushNotification(e){const t=new xe(Ge);return new Promise(((s,i)=>{const n={userVisibleOnly:!0,applicationServerKey:q.urlBase64ToUint8Array(M.getVAPID())};return t.d("Registration: ",e).writeLog(),M.getPermissionPush()||q.callEventPermission(ce.PERMISSION_TYPE_PUSH,Be.EVENT_TYPE_ASK),s(e.pushManager.subscribe(n))})).then((e=>{t.d("Received PushSubscription: ",e).writeLog(),M.getPermissionPush()&&M.getPermissionPush()===Be.EVENT_TYPE_ACCEPT||(q.callEventPermission(ce.PERMISSION_TYPE_PUSH,Be.EVENT_TYPE_ACCEPT),M.setPermissionPush(Be.EVENT_TYPE_ACCEPT));const s=e.toJSON();M.setBrowserPublicKey(s.keys.p256dh),M.setBrowserPrivateKey(s.keys.auth),M.setPushToken(s.endpoint),se.putDevice(new le,(e=>{he.getPermissions().then((e=>{Ye.isFunction(navigator.indigitallOnInitialized)&&navigator.indigitallOnInitialized(e,new H)})),Ye.isFunction(navigator.indigitallOnNewUserRegistered)&&!M.getNewUserTimestamp()&&(M.setNewUserTimestamp(Date.now()),navigator.indigitallOnNewUserRegistered(e)),qe.registerLocation()}),navigator.indigitallOnError),M.setServiceTimestamp(Date.now())})).catch((e=>{t.e("No Registration: "+e).writeLog(),M.getPermissionPush()&&M.getPermissionPush()===Be.EVENT_TYPE_REJECT||(q.callEventPermission(ce.PERMISSION_TYPE_PUSH,Be.EVENT_TYPE_REJECT),M.setPermissionPush(Be.EVENT_TYPE_REJECT)),Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(e)}))}static launchNotificationPermissionForSafari(){const e=new xe(Ge);if(M.getSafariWebsitePushId()&&M.getDeviceId()){const e=window.safari.pushNotification.permission(M.getSafariWebsitePushId());qe.checkRemotePermission(e)}else M.getSafariWebsitePushId()?e.w("error Device Id is not found").writeLog():e.w("error Safari Website Push Id is not found").writeLog()}static async checkRemotePermission(e){const t=new xe(Ge);try{if("default"===e.permission){const e={deviceCode:M.getDeviceId()};t.d("permission default: ",e).writeLog(),M.getPermissionPush()||q.callEventPermission(ce.PERMISSION_TYPE_PUSH,Be.EVENT_TYPE_ASK),window.safari.pushNotification.requestPermission(await se.getURL()+"/safari",M.getSafariWebsitePushId(),e,window.indigitall.checkRemotePermission)}else"denied"===e.permission?(t.w("permission denied: ",e).writeLog(),M.getPermissionPush()&&M.getPermissionPush()!=Be.EVENT_TYPE_REJECT&&(q.callEventPermission(ce.PERMISSION_TYPE_PUSH,Be.EVENT_TYPE_REJECT),M.setPermissionPush(Be.EVENT_TYPE_REJECT))):"granted"===e.permission&&(t.d("permission granted: ",e).writeLog(),M.getPermissionPush()&&M.getPermissionPush()!=Be.EVENT_TYPE_ACCEPT&&(q.callEventPermission(ce.PERMISSION_TYPE_PUSH,Be.EVENT_TYPE_ACCEPT),M.setPermissionPush(Be.EVENT_TYPE_ACCEPT)),e.deviceToken&&e.deviceToken!==M.getPushToken()&&(M.setPushToken(e.deviceToken),se.putDevice(new le,(e=>{if(Ye.isFunction(navigator.indigitallOnInitialized)){const e={};e.push=M.getPermissionPush(),e.location=M.getPermissionLocation(),navigator.indigitallOnInitialized(e,new H)}Ye.isFunction(navigator.indigitallOnNewUserRegistered)&&!M.getNewUserTimestamp()&&(M.setNewUserTimestamp(Date.now()),navigator.indigitallOnNewUserRegistered(e)),qe.registerLocation()}),navigator.indigitallOnError),M.setServiceTimestamp(Date.now()),M.setServiceTimestamp(Date.now())))}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_INITIALIZATION_ERROR,e))}}static registerLocation(){const e=new xe(Ge);try{navigator.geolocation&&M.getRequestLocation()&&M.getLocationEnabled()&&(!M.getLocationTimestamp()||M.getLocationUpdateMinutes()<=(Date.now()-M.getLocationTimestamp())/6e4)&&(M.getPermissionLocation()||q.callEventPermission(ce.PERMISSION_TYPE_LOCATION,Be.EVENT_TYPE_ASK),navigator.geolocation.getCurrentPosition((e=>{M.getPermissionLocation()||M.getPermissionLocation()==Be.EVENT_TYPE_ACCEPT||(q.callEventPermission(ce.PERMISSION_TYPE_LOCATION,Be.EVENT_TYPE_ACCEPT),M.setPermissionLocation(Be.EVENT_TYPE_ACCEPT));const t=new G;t.setLocation(e.coords.latitude,e.coords.longitude),se.postEventLocation(t),Ye.isFunction(navigator.indigitallOnLocationUpdated)&&navigator.indigitallOnLocationUpdated(e),M.setLocationTimestamp(Date.now())}),(t=>{e.e("error "+t).writeLog(),M.getPermissionLocation()||M.getPermissionLocation()==Be.EVENT_TYPE_REJECT||(q.callEventPermission(ce.PERMISSION_TYPE_LOCATION,Be.EVENT_TYPE_REJECT),M.setPermissionLocation(Be.EVENT_TYPE_REJECT))})))}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_EVENT_ERROR,e))}}static requestPushPermission(e){he.getPushPermission().then((t=>{Ye.isFunction(e)&&e(t)}))}static onPermissionChange(){he.setPermissionCallback()}static requestLocationPermission(e){he.getLocationPermission().then((t=>{Ye.isFunction(e)&&e(t)}))}static logIn(e,t,s){qe.setExternalId(e,t,s)}static logout(e,t){qe.setExternalId(null,e,t)}static setExternalCode(e,t,s){qe.setExternalId(e,t,s)}static async setExternalId(e,t,s){try{const i=M.getAppKey();if(!i)return void(Ye.isFunction(s)&&s(ke.showError(Y,Y.ErrorCode.API_APPKEY_NOT_VALID)));if(null!=e){const n=await Ke.createHmac(i,e);n&&this.setExternalIdRequest(n,t,s)}else this.setExternalIdRequest(null,t,s)}catch(e){Ye.isFunction(s)&&s(ke.showError(Y,Y.ErrorCode.PUSH_DEVICE_ERROR,e))}}static async setExternalIdRequest(e,t,s){const i=new le;M.setExternalId(e),await M.setExternalIdRequest(e),i.setExternalCode(e),se.putDevice(i,(e=>{Ye.isFunction(t)&&t(new H(e))}),s)}static sendCustomEvent(e,t,s){try{let i="",n={},o=!0;"string"==typeof e?i=e:"object"==typeof e&&(i=e.eventType,e.customData&&(n=e.customData),!1===e.async&&(o=e.async));const r=new G;r.setDeviceId(M.getDeviceId()),r.setEventType(i),r.setCustomData(n),null!=M.getExternalId()&&"null"!=M.getExternalId()?(r.setExternalCode(M.getExternalId()),r.setJourneyRequest(!0),!1===o?se.postEventJourneySync(r,t,s):se.postEventJourney(r,t,s)):!1===o?se.postEventCustomSync(r,t,s):se.postEventCustom(r,t,s)}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_EVENT_ERROR,e))}}static sendJourneyEvent(e,t,s){try{let i="",n={},o=!0;"string"==typeof e?i=e:"object"==typeof e&&(i=e.eventType,e.customData&&(n=e.customData),!1===e.async&&(o=e.async));const r=new G;r.setDeviceId(M.getDeviceId()),r.setExternalCodeRequest(),r.setEventType(i),r.setCustomData(n),r.setJourneyRequest(!0),!1===o?se.postEventJourneySync(r,t,s):se.postEventJourney(r,t,s)}catch(e){Ye.isFunction(navigator.indigitallOnError)&&navigator.indigitallOnError(ke.showError(Y,Y.ErrorCode.PUSH_EVENT_ERROR,e))}}static getInboxMessagesCount(e,t,s){Ye.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),L.getMessagesCount(t,s)}static getInbox(e,t,s){Ye.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),L.getInbox(t,s)}static getInboxWithPage(e,t,s,i,n,o,r,a){Ye.isFunction(e.getAuthConfig)&&(navigator.indigitallGetAuthConfig=getAuthConfig),L.getInboxWithPage(t,s,i,n,o,r,a)}static getCustomer(e,t){Le.getCustomer(e,t)}static getCustomerInformation(e,t){this.getCustomerInformationWithFields(null,e,t)}static getCustomerInformationWithFields(e,t,s){Le.getCustomerInformation(e,t,s)}static assignOrUpdateValueToCustomerFields(e,t,s){Le.updateValueToCustomerFields(e,t,s)}static deleteValuesFromCustomerFields(e,t,s){Le.deleteValuesFromCustomerFields(e,t,s)}static link(e,t,s,i){qe.logIn(e,(e=>{Le.linkCustomer(t,s,i)}),(e=>{Ye.isFunction(i)&&i(e)}))}static unlink(e,t,s){qe.logout((i=>{Le.unlinkCustomer(e,t,s)}),(e=>{Ye.isFunction(s)&&s(e)}))}}window.indigitall=qe,window.indigitall.InApp=t(),window.indigitall.InApp.Utils=t().Utils,window.indigitall.Channel=Fe,window.indigitall.LogLevel=Ve,window.indigitall.version=M.getVersion()})(),n})()));