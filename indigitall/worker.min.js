!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s=t();for(var i in s)("object"==typeof exports?exports:e)[i]=s[i]}}(this,(()=>(()=>{var e={923:function(e){var t;t=()=>(()=>{"use strict";var e={147:e=>{e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.1.0","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{s.r(i),s.d(i,{default:()=>f});var e={};s.r(e),s.d(e,{BaseClient:()=>m,BaseRequest:()=>p});var t={};s.r(t),s.d(t,{Channel:()=>P,Device:()=>A,DeviceStatus:()=>y,ErrorDictionary:()=>O,ErrorModel:()=>_,EventType:()=>N});var r={};s.r(r),s.d(r,{CommonUtils:()=>D,CorePermissions:()=>v,CryptoUtils:()=>C,ErrorUtils:()=>S,JsonUtils:()=>B,Log:()=>T,LogLevel:()=>g,Validations:()=>M});var o={platform:"webpush",version:"0.0.1"};const n=s(147);o.version=n.version;const a=o=Object.assign(o,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}}),E=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==E.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},h=E,c=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),o=r.index("storeIndex");e({db:t,tx:s,store:r,index:o})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}},l=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==l.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},I=l,d=class{constructor(){this.storage=h,this.db=c,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE"}setItemSessionStorage(e,t){I.setItem(e,t)}getItemSessionStorage(e){return I.getItem(e)}clearSessionStorage(){I.clearMessages()}setStorage(e,t){h.setItem(e,t)}getStorage(e){return h.getItem(e)}clearStorage(){h.clear()}setBrowserPublicKey(e){h.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return h.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){h.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return h.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){h.setItem(this.APP_KEY,e)}getAppKey(){return h.getItem(this.APP_KEY)}setVAPID(e){h.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return h.getItem(this.VAPID_PUBLIC)}setEnabled(e){h.setItem(this.ENABLED,e)}getEnabled(){return h.getItem(this.ENABLED)}setServiceSyncTime(e){h.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){return h.getItem(this.SERVICE_SYNC_TIME)||1*this.BASE_TIME}setLocationEnabled(e){h.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return h.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){h.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){return h.getItem(this.LOCATION_UPDATE_MINUTES)||30}async setRequestLocation(e){h.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!h&&h.getItem(this.REQUEST_LOCATION)}async setPlatform(e){h.setItem(this.PLATFORM,e)}getPlatform(){return h&&h.getItem(this.PLATFORM)||a.platform}getVersion(){return a.version}async setBrowserName(e){h.setItem(this.BROWSER_NAME,e)}getBrowserName(){return h.getItem(this.BROWSER_NAME)}setBrowserVersion(e){h.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return h.getItem(this.BROWSER_VERSION)}async setOsName(e){h.setItem(this.OS_NAME,e)}getOsName(){return h.getItem(this.OS_NAME)}setOsVersion(e){h.setItem(this.OS_VERSION,e)}getOsVersion(){return h.getItem(this.OS_VERSION)}setDeviceType(e){h.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return h.getItem(this.DEVICE_TYPE)}setSupported(e){h.setItem(this.SUPPORTED,e)}getSupported(){return h.getItem(this.SUPPORTED)}setServiceTimestamp(e){h.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return h.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){h.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return h.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){h.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return h.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){h.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==h.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){h.setItem(this.LOG_LEVEL,e)}getLogLevel(){return h.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){h.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return h.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){h&&h.isLocalStorageAvailable()&&h.setItem(this.EXTERNAL_ID,e),c&&c.IDB&&await c.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{h&&h.isLocalStorageAvailable()?e=h.getItem(this.EXTERNAL_ID):c&&c.IDB&&(e=await c.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){h.setItem(this.EXTERNAL_ID,e)}getExternalId(){return h.getItem(this.EXTERNAL_ID)}async getDeviceJson(){return h.getItem(this.DEVICE_JSON)}async setDeviceJson(e){h.setItem(this.DEVICE_JSON,e)}async getRegisteredByCookie(){return h.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){h.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){h.setItem(this.LATITUDE,e)}getLatitude(){return h.getItem(this.LATITUDE)}setLongitude(e){h.setItem(this.LONGITUDE,e)}getLongitude(){return h.getItem(this.LONGITUDE)}},g=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),u=g;class R{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=u.INFO,this.setLogLevel((new d).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=u.DEBUG&&e<=u.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=u.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}i(){if(this.level<=u.INFO)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}w(){if(this.level<=u.WARNING)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(){if(this.level<=u.ERROR)for(let e=0;e<arguments.length;e++)this.log+=R.addedAsString(arguments[e]);return this}e(e){return this.level<=u.ERROR&&(this.log+=`${e.errorCode}: ${e.errorMessage}`),this}writeLog(){this.log.length>0&&console.log(this.tag,this.log),this.log=[]}}const T=R,_=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}},S=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new _(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new _(GENERAL_ERROR,"general error",s)}}},O={ErrorCode:{GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410},ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}},m=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new T("[IND]BaseClient: ");let o=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(o=o.replace("v1","v2"));const n={method:e,headers:s.addHeaders()};e!==this.GET&&(n.body=JSON.stringify(s.getBody())),i&&(n.credentials=i);try{const t=await fetch(o,n),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog(),new _(t.status,t.statusText))}catch(t){return r.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),S.showError(O,O.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}},p=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new d).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},P=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"}),A=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new d).getBrowserPublicKey(),this.browserPrivateKey=(new d).getBrowserPrivateKey(),this.platform=(new d).getPlatform(),this.version=(new d).getVersion(),this.browserName=(new d).getBrowserName(),this.browserVersion=(new d).getBrowserVersion(),this.osName=(new d).getOsName(),this.osVersion=(new d).getOsVersion(),this.deviceType=(new d).getDeviceType(),(new d).getEnabled()&&(this.enabled="true"===(new d).getEnabled()),(new d).getExternalId()&&(this.externalCode=(new d).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new d).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new d).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}static setDeviceJson(e){(new d).setDeviceJson(JSON.stringify(e.toJSON()))}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},y=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),N=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"}),D=class{static isServiceTimestampExceed(){return!(new d).getServiceTimestamp()||(new d).getServiceSyncTime()<=(Date.now()-(new d).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}},v=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new T("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},L=new T("[IND]Crypto"),w=new TextEncoder("utf-8"),b="HMAC",C=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",w.encode(e),{name:b,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(b,i,w.encode(t)),o=new Uint8Array(r),n=Array.prototype.map.call(o,(e=>("00"+e.toString(16)).slice(-2))).join("");return L.d("hmac: ",n).writeLog(),n}catch(e){return void L.e("error:",e).writeLog()}}},B=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}},M=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},f={Repository:d,Config:a,Api:e,Models:t,Utils:r}})(),i})(),e.exports=t()},828:(e,t,s)=>{"use strict";s.d(t,{Core:()=>V});var i={};s.r(i),s.d(i,{BaseClient:()=>P,BaseRequest:()=>A});var r={};s.r(r),s.d(r,{Channel:()=>y,Device:()=>N,DeviceStatus:()=>D,ErrorDictionary:()=>p,ErrorModel:()=>S,EventType:()=>v});var o={};s.r(o),s.d(o,{CommonUtils:()=>L,CorePermissions:()=>w,CryptoUtils:()=>M,ErrorUtils:()=>O,JsonUtils:()=>f,Log:()=>_,LogLevel:()=>u,Validations:()=>U});s(923);var n={platform:"webpush",version:"0.0.1"};const a=s(391);n.version=a.version;const E=n=Object.assign(n,{client:{URL_BASE:"https://device-api.indigitall.com/v1",URL_DEVICE_V2:"https://device-api.indigitall.com/v2",INAPP_URL_BASE:"https://inapp-api.indigitall.com/v1",INBOX_URL_BASE:"https://inbox-api.indigitall.com/v1",CUSTOMER_URL_BASE:"https://device-api.indigitall.com/v2"}});const h=new class{constructor(){this.storage=this.isLocalStorageAvailable()?window.localStorage:null}isLocalStorageAvailable(){try{const e=window.localStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==h.length}return!1}setItem(e,t){return null!=this.storage&&(this.storage.setItem(e,t),!0)}getItem(e){return null!=this.storage?this.storage.getItem(e):null}deleteItem(e){return!!this.storage&&(this.storage.setItem(e,value),!0)}clear(){this.storage&&this.storage.clear()}},c=h;const l=new class{constructor(){this.TAG="[IND]IndexedDB: ",this.DB_NAME="indigitall.indexedDB",this.DB_VERSION=1,this.DB_STORE_NAME="indigitallStore",this.DB_STORE_MODE="readwrite",this.DB_KEY_PATH="id",this.DB_STORE_INDEX="storeIndex",this.IDB=indexedDB||mozzIndexedDB||webkitIndexedDB||msIndexedDB}async getDB(){return new Promise(((e,t)=>{const s=this.IDB;if(s){const i=s.open("indigitall.indexedDB",1);i.onupgradeneeded=function(){i.result.createObjectStore("indigitallStore").createIndex("storeIndex","store.key")},i.onsuccess=function(){const t=i.result,s=t.transaction("indigitallStore","readwrite"),r=s.objectStore("indigitallStore"),o=r.index("storeIndex");e({db:t,tx:s,store:r,index:o})},i.onerror=function(e){t(e)}}else t(!1)}))}async get(e,t){return new Promise(((s,i)=>{e||i(!1),e.index.get(t).onsuccess=t=>{t.target.result&&(this.close(e),s(t.target.result.store.value)),i(!1)}}))}async put(e,t,s){return new Promise(((i,r)=>{e||r(!1),e.store.put({store:{key:t,value:s}},t).onsuccess=t=>{this.close(e),i(s)}}))}close(e){if(e.tx)try{e.tx.oncomplete=()=>{e.db.close()}}catch(e){console.error(this.TAG,e)}}async setItem(e,t){try{const s=await this.getDB();return this.put(s,e,t)}catch(e){return e}}async getItem(e){try{const t=await this.getDB();return this.get(t,e)}catch(e){return e}}};const I=new class{constructor(){this.SESSION="indigitall.session.storage",this.session=this.isSessionStorageAvailable()?window.sessionStorage:null}isSessionStorageAvailable(){try{const e=window.sessionStorage,t="__storage_test__";if(e)return e.setItem(t,t),e.removeItem(t),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==I.length}return!1}getItem(e){return null!=this.session?this.session.getItem(e):null}setItem(e,t){return null!=this.session&&(this.session.setItem(e,t),!0)}clearMessages(){this.session&&this.session.removeItem("messages")}},d=I;const g=class{constructor(){this.storage=c,this.db=l,this.BASE_TIME=60,this.REPOSITORY="indigitall.repository",this.APP_KEY=this.REPOSITORY+".APP_KEY",this.VAPID_PUBLIC=this.REPOSITORY+".VAPID_PUBLIC",this.ENABLED=this.REPOSITORY+".ENABLED",this.DEVICE_ID=this.REPOSITORY+".DEVICE_ID",this.SERVICE_SYNC_TIME=this.REPOSITORY+".SERVICE_SYNC_TIME",this.LOCATION_ENABLED=this.REPOSITORY+".LOCATION_ENABLED",this.LOCATION_UPDATE_MINUTES=this.REPOSITORY+".LOCATION_UPDATE_MINUTES",this.REQUEST_LOCATION=this.REPOSITORY+".REQUEST_LOCATION",this.BROWSER_PUBLIC_KEY=this.REPOSITORY+".BROWSER_PUBLIC_KEY",this.BROWSER_PRIVATE_KEY=this.REPOSITORY+".BROWSER_PRIVATE_KEY",this.PLATFORM=this.REPOSITORY+".PLATFORM",this.BROWSER_NAME=this.REPOSITORY+".BROWSER_NAME",this.BROWSER_VERSION=this.REPOSITORY+".BROWSER_VERSION",this.OS_NAME=this.REPOSITORY+".OS_NAME",this.OS_VERSION=this.REPOSITORY+".OS_VERSION",this.DEVICE_TYPE=this.REPOSITORY+".DEVICE_TYPE",this.SUPPORTED=this.REPOSITORY+".SUPPORTED",this.SERVICE_TIMESTAMP=this.REPOSITORY+".SERVICE_TIMESTAMP",this.LOCATION_TIMESTAMP=this.REPOSITORY+".LOCATION_TIMESTAMP",this.PERMISSION_LOCATION=this.REPOSITORY+".PERMISSION_LOCATION",this.SET_LOG_DEBUG=this.REPOSITORY+".SET_LOG_DEBUG",this.NEW_USER_TIMESTAMP=this.REPOSITORY+".NEW_USER_TIMESTAMP",this.EXTERNAL_ID=this.REPOSITORY+".EXTERNAL_ID",this.REGISTERED_BY_COOKIE=this.REPOSITORY+".REGISTERED_BY_COOKIE",this.LOG_LEVEL=this.REPOSITORY+".LOG_LEVEL",this.LATITUDE=this.REPOSITORY+".LATITUDE",this.LONGITUDE=this.REPOSITORY+".LONGITUDE"}setItemSessionStorage(e,t){d.setItem(e,t)}getItemSessionStorage(e){return d.getItem(e)}clearSessionStorage(){d.clearMessages()}setStorage(e,t){c.setItem(e,t)}getStorage(e){return c.getItem(e)}clearStorage(){c.clear()}setBrowserPublicKey(e){c.setItem(this.BROWSER_PUBLIC_KEY,e)}getBrowserPublicKey(){return c.getItem(this.BROWSER_PUBLIC_KEY)}setBrowserPrivateKey(e){c.setItem(this.BROWSER_PRIVATE_KEY,e)}getBrowserPrivateKey(){return c.getItem(this.BROWSER_PRIVATE_KEY)}async setAppKey(e){c.setItem(this.APP_KEY,e)}getAppKey(){return c.getItem(this.APP_KEY)}setVAPID(e){c.setItem(this.VAPID_PUBLIC,e)}getVAPID(){return c.getItem(this.VAPID_PUBLIC)}setEnabled(e){c.setItem(this.ENABLED,e)}getEnabled(){return c.getItem(this.ENABLED)}setServiceSyncTime(e){c.setItem(this.SERVICE_SYNC_TIME,e*this.BASE_TIME)}getServiceSyncTime(){const e=c.getItem(this.SERVICE_SYNC_TIME);return e||1*this.BASE_TIME}setLocationEnabled(e){c.setItem(this.LOCATION_ENABLED,e)}getLocationEnabled(){return c.getItem(this.LOCATION_ENABLED)}setLocationUpdateMinutes(e){c.setItem(this.LOCATION_UPDATE_MINUTES,e)}getLocationUpdateMinutes(){const e=c.getItem(this.LOCATION_UPDATE_MINUTES);return e||30}async setRequestLocation(e){c.setItem(this.REQUEST_LOCATION,e)}getRequestLocation(){return!!c&&c.getItem(this.REQUEST_LOCATION)}async setPlatform(e){c.setItem(this.PLATFORM,e)}getPlatform(){return c&&c.getItem(this.PLATFORM)||E.platform}getVersion(){return E.version}async setBrowserName(e){c.setItem(this.BROWSER_NAME,e)}getBrowserName(){return c.getItem(this.BROWSER_NAME)}setBrowserVersion(e){c.setItem(this.BROWSER_VERSION,e)}getBrowserVersion(){return c.getItem(this.BROWSER_VERSION)}async setOsName(e){c.setItem(this.OS_NAME,e)}getOsName(){return c.getItem(this.OS_NAME)}setOsVersion(e){c.setItem(this.OS_VERSION,e)}getOsVersion(){return c.getItem(this.OS_VERSION)}setDeviceType(e){c.setItem(this.DEVICE_TYPE,e)}getDeviceType(){return c.getItem(this.DEVICE_TYPE)}setSupported(e){c.setItem(this.SUPPORTED,e)}getSupported(){return c.getItem(this.SUPPORTED)}setServiceTimestamp(e){c.setItem(this.SERVICE_TIMESTAMP,e)}getServiceTimestamp(){return c.getItem(this.SERVICE_TIMESTAMP)}setLocationTimestamp(e){c.setItem(this.LOCATION_TIMESTAMP,e)}getLocationTimestamp(){return c.getItem(this.LOCATION_TIMESTAMP)}setPermissionLocation(e){c.setItem(this.PERMISSION_LOCATION,e)}getPermissionLocation(){return c.getItem(this.PERMISSION_LOCATION)}setDebugLog(e){c.setItem(this.SET_LOG_DEBUG,e)}getDebugLog(){return"false"!==c.getItem(this.SET_LOG_DEBUG)}setLogLevel(e){c.setItem(this.LOG_LEVEL,e)}getLogLevel(){return c.getItem(this.LOG_LEVEL)}setNewUserTimestamp(e){c.setItem(this.NEW_USER_TIMESTAMP,e)}getNewUserTimestamp(){return c.getItem(this.NEW_USER_TIMESTAMP)}async setExternalIdRequest(e){c&&c.isLocalStorageAvailable()&&c.setItem(this.EXTERNAL_ID,e),l&&l.IDB&&await l.setItem(this.EXTERNAL_ID,e)}async getExternalIdRequest(){let e;try{c&&c.isLocalStorageAvailable()?e=c.getItem(this.EXTERNAL_ID):l&&l.IDB&&(e=await l.getItem(this.EXTERNAL_ID))}catch(e){}return e}setExternalId(e){c.setItem(this.EXTERNAL_ID,e)}getExternalId(){return c.getItem(this.EXTERNAL_ID)}async getDeviceJson(){return c.getItem(this.DEVICE_JSON)}async setDeviceJson(e){c.setItem(this.DEVICE_JSON,e)}async getRegisteredByCookie(){return c.getItem(this.REGISTERED_BY_COOKIE)}async setRegisteredByCookie(e){c.setItem(this.REGISTERED_BY_COOKIE,e)}setLatitude(e){c.setItem(this.LATITUDE,e)}getLatitude(){return c.getItem(this.LATITUDE)}setLongitude(e){c.setItem(this.LONGITUDE,e)}getLongitude(){return c.getItem(this.LONGITUDE)}},u=Object.freeze({DEBUG:1,INFO:2,WARNING:3,ERROR:4}),R=u;class T{constructor(e){this.tag="[IND]",e&&(this.tag=e),this.level=R.INFO,this.setLogLevel((new g).getLogLevel()),this.log=[]}setLogLevel(e){e&&e>=R.DEBUG&&e<=R.ERROR&&(this.level=e)}static addedAsString(e){return"string"==typeof e?e:JSON.stringify(e,null,2)}d(){if(this.level<=R.DEBUG)for(let e=0;e<arguments.length;e++)this.log+=T.addedAsString(arguments[e]);return this}i(){if(this.level<=R.INFO)for(let e=0;e<arguments.length;e++)this.log+=T.addedAsString(arguments[e]);return this}w(){if(this.level<=R.WARNING)for(let e=0;e<arguments.length;e++)this.log+=T.addedAsString(arguments[e]);return this}e(){if(this.level<=R.ERROR)for(let e=0;e<arguments.length;e++)this.log+=T.addedAsString(arguments[e]);return this}e(e){return this.level<=R.ERROR&&(this.log+=`${e.errorCode}: ${e.errorMessage}`),this}writeLog(){this.log.length>0&&console.log(this.tag,this.log),this.log=[]}}const _=T;const S=class{constructor(e,t,s){this.errorCode=e,this.errorMessage=t,null!=s&&(this.exceptionMessage=s)}};const O=new class{constructor(){}showError(e,t,s){if(null!=e){const i=Object.values(e.ErrorCode).indexOf(t);return i>=0?new S(Object.keys(e.ErrorCode)[i],Object.keys(e.ErrorMessage)[i],s):new S(GENERAL_ERROR,"general error",s)}}},m={GENERAL_ERROR:600,API_SERVER_ERROR:500,API_PARAMETER_MISSING:400,API_APPKEY_NOT_VALID:401,API_FORBIDDEN_REQUEST:403,API_DEVICE_NOT_FOUND:404,API_TOPICS_ARE_INSERTED:409,BAD_REQUEST_SERVER_ERROR:410};const p={ErrorCode:m,ErrorMessage:{GENERAL_ERROR:"General Error",API_SERVER_ERROR:"Error server response",API_PARAMETER_MISSING:"Api parameter missing",API_APPKEY_NOT_VALID:"appKey is not valid",API_FORBIDDEN_REQUEST:"forbidden request",API_DEVICE_NOT_FOUND:"device not found",API_TOPICS_ARE_INSERTED:"topics are inserted",BAD_REQUEST_SERVER_ERROR:"bad request"}};const P=class{constructor(){this.URL_BASE="",this.GET="GET",this.POST="POST",this.PUT="PUT",this.DELETE="DELETE"}async getURL(){return this.URL_BASE}async call(e,t,s,i){const r=new _("[IND]BaseClient: ");let o=await this.getURL()+s.getPath(t)+s.getParams();s.isJourneyRequest()&&(o=o.replace("v1","v2"));const n={method:e,headers:s.addHeaders()};e!==this.GET&&(n.body=JSON.stringify(s.getBody())),i&&(n.credentials=i);try{const t=await fetch(o,n),i=await t.json();return t.ok?(r.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+i.statusCode+"\nResponse Message: "+i.message+"\nResponse Body:",JSON.stringify(i.data,null,"\t")).writeLog(),i):(r.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog(),new S(t.status,t.statusText))}catch(t){return r.d("Method: "+e+"\nURL: "+o+"\n"+(e!==this.GET?"Request Body: "+JSON.stringify(s.getBody(),null,"\t")+"\n":"")+"Error: "+t).writeLog(),O.showError(p,p.ErrorCode.GENERAL_ERROR,t)}}async get(e,t){return await this.call(this.GET,e,t)}async post(e,t,s){return await this.call(this.POST,e,t,s)}async put(e,t,s){return await this.call(this.PUT,e,t,s)}async delete(e,t){return await this.call(this.DELETE,e,t)}};const A=class{constructor(){this.PARAM_APP_KEY="appKey",this.PARAM_DEVICE_ID="deviceId",this.PARAM_PUSH_TOKEN="pushToken",this.PARAM_ENABLED="enabled",this.PARAM_PLATFORM="platform",this.PARAM_VERSION="version",this.PARAM_TOPICS="topics",this.PARAM_EVENT_TYPE="eventType",this.PARAM_PUSH_ID="pushId",this.PARAM_CLICKED_BUTTON="clickedButton",this.PARAM_PERMISSION_TYPE="permissionType",this.PARAM_LATITUDE="latitude",this.PARAM_LONGITUDE="longitude",this.PARAM_INAPP_ID="inAppId",this.PARAM_INAPP_EVENT_TYPE="eventType",this.PARAM_INAPP_CLICKED_BUTTON="clickedButton",this.PARAM_INAPP_LAST_VERSION_ID="lastVersionId",this.PARAM_INBOX_EXTERNALID="externalId",this.PARAM_INBOX_PAGE="page",this.PARAM_INBOX_PAGE_SIZE="pageSize",this.PARAM_INBOX_DATE_FROM="dateFrom",this.PARAM_INBOX_DATE_TO="dateTo",this.PARAM_INBOX_STATUS="status",this.PARAM_INBOX_SENDER_IDS="sendingIds",this.PARAM_CUSTOMER_ID="customerId",this.PARAM_CUSTOMER_FIELD_NAMES="fieldNames",this.PARAM_CUSTOMER_FIELDS="fields",this.PARAM_CUSTOMER_LINK="link",this.PARAM_CUSTOMER_CHANNEL="channel",this.appKey=(new g).getAppKey(),this.params=null,this.pathParams={},this.headers={}}getParams(){return"?"+this.PARAM_APP_KEY+"="+this.appKey+(this.params?"&"+this.params:"")}getBody(){return this.body?this.body:""}getPath(e){let t=e;return Object.keys(this.pathParams).forEach((e=>{t=t.replace(e,this.pathParams[e])})),t}addHeaders(){const e=new Headers({"Content-Type":"application/json"});return Object.keys(this.headers).forEach((t=>{e.append(t,this.headers[t])})),e}isJourneyRequest(){return this.journeyRequest}setJourneyRequest(e){this.journeyRequest=e}},y=Object.freeze({PUSH:"push",INAPP:"inapp",CHAT:"chat"});const N=class{constructor(e=null,t){null==e?(this.browserPublicKey=(new g).getBrowserPublicKey(),this.browserPrivateKey=(new g).getBrowserPrivateKey(),this.platform=(new g).getPlatform(),this.version=(new g).getVersion(),this.browserName=(new g).getBrowserName(),this.browserVersion=(new g).getBrowserVersion(),this.osName=(new g).getOsName(),this.osVersion=(new g).getOsVersion(),this.deviceType=(new g).getDeviceType(),(new g).getEnabled()&&(this.enabled="true"===(new g).getEnabled()),(new g).getExternalId()&&(this.externalCode=(new g).getExternalId())):t?(e.enabled&&(this.enabled=e.enabled,(new g).setEnabled(this.enabled)),e.registeredByCookie&&(this.registeredByCookie=e.registeredByCookie,(new g).setRegisteredByCookie(this.registeredByCookie))):(e.browserPublicKey&&(this.browserPublicKey=e.browserPublicKey),e.browserPrivateKey&&(this.browserPrivateKey=e.browserPrivateKey),e.platform&&(this.platform=e.platform),e.version&&(this.version=e.version),e.osVersion&&(this.osVersion=e.osVersion),e.browserName&&(this.browserName=e.browserName),e.browserVersion&&(this.browserVersion=e.browserVersion),e.osName&&(this.osName=e.osName),e.deviceType&&(this.deviceType=e.deviceType),e.enabled&&(this.enabled=e.enabled),e.externalCode&&(this.externalCode=e.externalCode)),this.platform&&(this.productName=this.platform),this.version&&(this.productVersion=this.version),navigator&&"language"in navigator&&(this.locale=navigator.language),Intl&&"DateTimeFormat"in Intl&&(this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone),this.timeOffset=-(new Date).getTimezoneOffset()}getDeviceId(){return this.deviceId}setDeviceId(e){this.deviceId=e}setExternalCode(e){this.externalCode=e}static setDeviceJson(e){(new g).setDeviceJson(JSON.stringify(e.toJSON()))}toJSON(){const e={};return this.platform&&(e.platform=this.platform),this.version&&(e.version=this.version),this.productName&&(e.productName=this.productName),this.productVersion&&(e.productVersion=this.productVersion),this.browserName&&(e.browserName=this.browserName),this.browserVersion&&(e.browserVersion=this.browserVersion),this.osName&&(e.osName=this.osName),this.osVersion&&(e.osVersion=this.osVersion),this.deviceType&&(e.deviceType=this.deviceType),this.locale&&(e.locale=this.locale),this.timeZone&&(e.timeZome=this.timeZone),this.timeOffset&&(e.timeOffset=this.timeOffset),this.enabled&&(e.enabled=this.enabled),this.browserPublicKey&&(e.browserPublicKey=this.browserPublicKey),this.browserPrivateKey&&(e.browserPrivateKey=this.browserPrivateKey),this.externalCode&&(e.externalCode=this.externalCode),e}},D=Object.freeze({DEFAULT:-1,ENABLE:1,DISABLE:0}),v=Object.freeze({EVENT_TYPE_CLICK:"click",EVENT_TYPE_RECEIVE:"receive",EVENT_TYPE_UPDATE:"update",EVENT_TYPE_ACCEPT:"accept",EVENT_TYPE_REJECT:"reject",EVENT_TYPE_ASK:"ask"});const L=class{static isServiceTimestampExceed(){return!(new g).getServiceTimestamp()||(new g).getServiceSyncTime()<=(Date.now()-(new g).getServiceTimestamp())/6e4}static isFunction(e){return!(!e||"function"!=typeof e)}};const w=class{static async getPermissions(){const e=await this.getPermission("geolocation"),t={};return e&&(t.location=e.state),t}static async getPermission(e){try{if(navigator&&navigator.permissions&&navigator.permissions.query&&e)return await navigator.permissions.query({name:e,userVisibleOnly:!0})}catch(e){return null}return null}static async setPermissionsCallback(){await this.setCallback("geolocation",navigator.indigitallRequestLocationPermission)}static async setCallback(e,t){const s=await this.getPermission(e);if(s){let i=s.state;"onchange"in s&&(s.onchange=()=>{new _("[IND]CorePermissions: ").d(e+" permission state has changed from "+i+" to "+s.state).writeLog(),i=s.state,t&&t({name:e,state:s.state})})}}},b=new _("[IND]Crypto"),C=new TextEncoder("utf-8"),B="HMAC";const M=class{static async createHmac(e,t){try{const s=window?.crypto?.subtle;if(!s)return;const i=await s.importKey("raw",C.encode(e),{name:B,hash:{name:"SHA-256"}},!1,["sign","verify"]),r=await s.sign(B,i,C.encode(t)),o=new Uint8Array(r),n=Array.prototype.map.call(o,(e=>("00"+e.toString(16)).slice(-2))).join("");return b.d("hmac: ",n).writeLog(),n}catch(e){return void b.e("error:",e).writeLog()}}};const f=class{static compareJSON(e,t){const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const i of s)if(e[i]!==t[i]){if("object"!=typeof e[i]||"object"!=typeof t[i])return!1;if(!isEqual(e[i],t[i]))return!1}return!0}};const U=class{static isValidFormat(e){return null!=e&&""!=e&&"null"!=e&&e.length>8}},V={Repository:g,Config:E,Api:i,Models:r,Utils:o}},391:e=>{"use strict";e.exports=JSON.parse('{"name":"indigitall-web-core","description":"indigitall web core","version":"4.1.0","main":"index.js","author":"Smart2me S.L.","homepage":"https://indigitall.com","devDependencies":{"@babel/preset-env":"^7.18.10","babel-loader":"^8.2.5","filemanager-webpack-plugin":"^7.0.0","idempotent-babel-polyfill":"^7.4.4","script-loader":"^0.7.2","webpack":"^5.74.0","webpack-bundle-analyzer":"^4.6.1","webpack-cli":"^4.10.0"},"scripts":{"test":"echo \'There are not tests\'","public":"ws --directory ./public --port 80 --log.format dev","build":"webpack --config webpack.config.js --mode=production","build-dev":"webpack --config webpack.config.js --watch --mode=development","delete-node-modules":"rm -rf node_modules/ && rm -f package-lock.json","install-core":"npm install && npm run build"}}')}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";s.r(i);const{Repository:e}=s(828).Core;const t=new class extends e{constructor(){super(),this.SAFARI_WEBSITE_PUSH_ID=this.REPOSITORY+".SAFARI_WEBSITE_PUSH_ID",this.PUSH_TOKEN=this.REPOSITORY+".PUSH_TOKEN",this.PERMISSION_PUSH=this.REPOSITORY+".PERMISSION_PUSH",this.URL_DEVICE_API=this.REPOSITORY+".URL_DEVICE_API",this.DEVICE_JSON=this.REPOSITORY+".DEVICE_JSON",this.PUT_REQUEST_TIMESTAMP=this.REPOSITORY+".PUT_REQUEST_TIMESTAMP"}async setDeviceId(e){this.setStorage(this.DEVICE_ID,e)}getDeviceId(){return this.getStorage(this.DEVICE_ID)}setPushToken(e){this.setStorage(this.PUSH_TOKEN,e)}getPushToken(){return this.getStorage(this.PUSH_TOKEN)}setSafariWebsitePushId(e){this.setStorage(this.SAFARI_WEBSITE_PUSH_ID,e)}getSafariWebsitePushId(){return this.getStorage(this.SAFARI_WEBSITE_PUSH_ID)}setPermissionPush(e){this.setStorage(this.PERMISSION_PUSH,e)}getPermissionPush(){return this.getStorage(this.PERMISSION_PUSH)}async getUrlDeviceApi(){let e;try{this.storage&&this.storage.isLocalStorageAvailable()?e=this.getStorage(this.URL_DEVICE_API):this.db&&this.db.IDB&&(e=await this.db.getItem(this.URL_DEVICE_API))}catch(e){}return e}async setUrlDeviceApi(e){this.storage&&this.storage.isLocalStorageAvailable()&&this.setStorage(this.URL_DEVICE_API,e),this.db&&this.db.IDB&&await this.db.setItem(this.URL_DEVICE_API,e)}async getDeviceJson(){return this.getStorage(this.DEVICE_JSON)}async setDeviceJson(e){this.setStorage(this.DEVICE_JSON,e)}async getPutRequestTimestamp(){return this.getStorage(this.PUT_REQUEST_TIMESTAMP)}async setPutRequestTimestamp(e){this.setStorage(this.PUT_REQUEST_TIMESTAMP,e)}},{BaseRequest:r}=s(828).Core.Api,{EventType:o}=s(828).Core.Models;const n=class extends r{constructor(){super()}setEventType(e){this.eventType=e}setPushId(e){this.pushId=e}setClickedButton(e){this.clickedButton=e}setSendingId(e){this.sendingId=e}setPermissionType(e){this.permissionType=e}setLocation(e,t){this.latitude=e,this.longitude=t}setDeviceId(e){this.deviceId=e}setPlatform(e){this.platform=e}setAppKey(e){this.appKey=e}setCustomData(e){this.customData=e}async setExternalCodeRequest(){this.externalCode=await t.getExternalIdRequest()}setExternalCode(e){this.externalCode=e}setCampaingId(e){this.campaignId=e}setJourneyStateId(e){this.journeyStateId=e}postEventPushRequest(){const e={};return e.deviceId=this.deviceId,e.platform=this.platform,this.eventType&&(e.eventType=this.eventType),this.pushId&&(e.pushId=this.pushId),e.clickedButton=this.clickedButton,null!=this.externalCode&&(e.externalCode=this.externalCode),this.sendingId&&"undefined"!=this.sendingId&&(e.sendingId=this.sendingId),this.journeyStateId&&(e.journeyStateId=this.journeyStateId),this.campaignId&&(e.campaignId=this.campaignId),this.body=e,this}postEventVisitRequest(){const e={};return e.deviceId=t.getDeviceId(),e.eventType=o.EVENT_TYPE_UPDATE,this.body=e,this}postEventPermissionRequest(){const e={};return e.deviceId=t.getDeviceId(),this.eventType&&(e.eventType=this.eventType),this.permissionType&&(e.permissionType=this.permissionType),this.body=e,this}postEventLocationRequest(){const e={};return e.deviceId=t.getDeviceId(),e.eventType=o.EVENT_TYPE_UPDATE,this.latitude&&(e.latitude=this.latitude),this.longitude&&(e.longitude=this.longitude),this.body=e,this}postEventCustomRequest(){const e={};return this.deviceId&&(e.deviceId=this.deviceId),this.eventType&&(e.eventType=this.eventType),this.customData&&(e.customData=this.customData),this.externalCode&&(e.externalCode=this.externalCode),this.body=e,this}},{Device:a}=s(828).Core.Models;const E=class extends a{constructor(e=null,s){super(e,s),null==e?(null!=t.getDeviceId()&&(this.deviceId=t.getDeviceId()),null!=t.getPushToken()&&(this.pushToken=t.getPushToken())):s?e.deviceId&&(this.deviceId=e.deviceId,t.setDeviceId(this.deviceId)):(e.deviceId&&(this.deviceId=e.deviceId),e.pushToken&&(this.pushToken=e.pushToken))}getDeviceId(){return this.deviceId}getPushToken(){return this.pushToken}toJSON(){const e=super.toJSON();return this.deviceId&&(e.deviceId=this.deviceId),this.pushToken&&(e.pushToken=this.pushToken),e}},{DeviceStatus:h}=s(828).Core.Models,{BaseRequest:c}=s(828).Core.Api;const l=class extends c{constructor(e=h.DEFAULT){super(),this.device=new E,this.status=e,this.notToUpdate=!1}setDeviceId(e){this.device&&(this.device.deviceId=e)}setAppKey(e){this.appKey=e}getDeviceRequest(){return this.params=this.createQueryString(),this}postDeviceRequest(){return this.body=this.createDeviceJson(),this.status!==h.DEFAULT&&(this.body.enabled=1===this.status),this}putDeviceRequest(e){return this.params=this.createQueryString(),this.body=this.createPUTDeviceJson(e),this.status!==h.DEFAULT&&(this.body.enabled=1===this.status),this}getDeviceTopicsRequest(){return this.params=this.createQueryString(),this}postDeviceTopicsRequest(){return this.params=this.createQueryString(),this.body=this.createTopicsJson(),this}deleteDeviceTopicsRequest(){return this.params=this.createQueryString(),this.body=this.createTopicsJson(),this}createQueryString(){return this.PARAM_DEVICE_ID+"="+this.device.deviceId}createDeviceJson(){let e={};try{e=this.device.toJSON()}catch(e){}return e}createPUTDeviceJson(e){let t={};try{E.setDeviceJson(e),t=e.toJSON()}catch(e){}return t}createTopicsJson(){const e={};return this.topics&&(e.topics=this.topics),e}getDeviceId(){return this.device.getDeviceId()}setTopics(e){this.topics=e}setExternalCode(e){this.device.setExternalCode(e)}},{EventType:I,ErrorModel:d}=s(828).Core.Models,{Config:g}=s(828).Core,{Log:u,LogLevel:R}=s(828).Core.Utils,T="[IND]service-worker",_="/push",S="/event/click";async function O(e,s,i){const r=await t.getUrlDeviceApi(),o=new l;o.setAppKey(e),o.setDeviceId(s),o.setTopics(i);const n=await m("POST",r,"/device/topics",o.postDeviceTopicsRequest());!n||n instanceof d?console.log("topics subscribe notification error",n):console.log(n.data.topics)}async function m(e,t,s,i,r){const o=new u(T);o.setLogLevel(R.DEBUG);const n=t+i.getPath(s)+i.getParams(),a={method:e,headers:i.addHeaders()};"GET"!==e&&(a.body=JSON.stringify(i.getBody())),r&&(a.credentials=r);try{o.d("Method: "+e+"\nURL: "+n+"\n").writeLog();const t=await fetch(n,a),s=await t.json();return t.ok?(o.d("GET"!==e?`Request Body: ${JSON.stringify(i.getBody(),null,"\t")}\n`:"Response Code: "+s.statusCode+"\nResponse Message: "+s.message+"\nResponse Body:",JSON.stringify(s.data,null,"\t")).writeLog(),s):void o.d("GET"!==e?`Request Body: ${JSON.stringify(i.getBody(),null,"\t")}\n`:"Response Code: "+t.status+"\nResponse Message: "+t.statusText+"\n").writeLog()}catch(t){return void o.d("GET"!==e?`Request Body: ${JSON.stringify(i.getBody(),null,"\t")}\n`:`Error: ${t}`).writeLog()}}self.addEventListener("push",(function(e){const t=new u(T);t.setLogLevel(R.DEBUG),t.d("Received a push message ",e.data.json()).writeLog();const s=e.data.json(),i=s.title,r={};s.body&&(r.body=s.body),s.icon&&(r.icon=s.icon),s.image&&("image"in Notification.prototype?r.image=s.image:s.imageSquare?r.icon=s.imageSquare:r.icon=s.image),s.monochrome&&(r.badge=s.monochrome);const o={};if(o.appKey=s.appKey||"",o.deviceId=s.deviceId||"",o.id=s.id||0,o.sendingId=s.sendingId,o.campaignId=s.campaignId,s.journeyStateId&&(o.journeyStateId=s.journeyStateId),s.action){const e=s.action;t.d("action: ",e).writeLog(),e.url&&(o.url=e.url),e.topics&&(o.topics=e.topics)}if(Array.isArray(s.buttons)){const e=[],i=[],n=[];t.d("buttons: ",s.buttons).writeLog();for(let t=0;t<s.buttons.length;t++){const r=s.buttons[t];e.push({action:"action-"+(t+1),title:r.label}),r.action&&r.action.url&&i.push(r.action.url),r.action&&r.action.topics&&n.push(r.action.topics)}e.length>0&&(r.actions=e),i.length>0&&(o.actions=i),n.length>0&&(o.buttonTopics=n)}if(r.data=o,s.requireInteraction&&(r.requireInteraction=s.requireInteraction),s.extraFields&&"object"==typeof s.extraFields){const e={};Object.keys(s.extraFields).forEach((t=>{const i=s.extraFields[t];e[i]=s[t]})),Object.assign(r,e)}e.waitUntil(self.registration.showNotification(i,r))})),self.addEventListener("notificationclick",(async function(e){const s=new u(T);s.setLogLevel(R.DEBUG),s.d("On notification click: ",e.notification).writeLog();const i=e.notification.data;e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then((function(t){for(let e=0;e<t.length;e++){const s=t[e];if("/"===s.url&&"focus"in s)return s.focus()}if(clients.openWindow)return"action-1"==e.action?(i.buttonTopics&&i.buttonTopics[0]&&O(i.appKey,i.deviceId,i.buttonTopics[0]),clients.openWindow(i.actions[0])):"action-2"==e.action?(i.buttonTopics&&i.buttonTopics[1]&&O(i.appKey,i.deviceId,i.buttonTopics[1]),clients.openWindow(i.actions[1])):(i.topics&&O(i.appKey,i.deviceId,i.topics),clients.openWindow(i.url))}))),e.preventDefault();const r=new n;r.setAppKey(i.appKey),r.setDeviceId(i.deviceId),r.setPlatform(g.platform),r.setPushId(""+i.id),r.setSendingId(""+i.sendingId),i.campaignId&&r.setCampaingId(""+i.campaignId),i.journeyStateId&&r.setJourneyStateId(i.journeyStateId),r.setEventType(I.EVENT_TYPE_CLICK),await r.setExternalCodeRequest(),"action-1"==e.action?r.setClickedButton(1):"action-2"==e.action?r.setClickedButton(2):r.setClickedButton(0),await async function(e){let s=await t.getUrlDeviceApi(),i="/event/push";e.journeyStateId&&(s=s.replace("v1","v2"),i=_+S);await m("POST",s,i,e.postEventPushRequest(),"include")}(r)}))})(),i})()));